{
  "dockerhub": {
    "web_url": "https://hub.docker.com/r/jdeathe/centos-ssh",
    "repository_url": "https://hub.docker.com/v2/repositories/jdeathe/centos-ssh",
    "tags_url": "https://hub.docker.com/v2/repositories/jdeathe/centos-ssh/tags",
    "dockerfile_url": "https://hub.docker.com/v2/repositories/jdeathe/centos-ssh/dockerfile",
    "autobuild_url": "https://hub.docker.com/v2/repositories/jdeathe/centos-ssh/autobuild",
    "user": "jdeathe",
    "name": "centos-ssh",
    "namespace": "jdeathe",
    "status": 1,
    "is_private": false,
    "is_automated": true,
    "star_count": 41,
    "pull_count": 754596,
    "last_updated": "2016-10-02T05:31:56.963327Z",
    "permissions": {
      "read": true,
      "write": false,
      "admin": false
    },
    "tags": [
      {
        "name": "centos-7",
        "full_size": 80761527,
        "id": 2139364,
        "repository": 30477,
        "creator": 19526,
        "last_updater": 19526,
        "last_updated": "2016-10-02T05:31:56.484670Z",
        "image_id": null,
        "v2": true,
        "platforms": [
          5
        ]
      },
      {
        "name": "centos-7-2.1.3",
        "full_size": 80761500,
        "id": 5188035,
        "repository": 30477,
        "creator": 19526,
        "last_updater": 19526,
        "last_updated": "2016-10-02T05:30:11.462499Z",
        "image_id": null,
        "v2": true,
        "platforms": [
          5
        ]
      },
      {
        "name": "latest",
        "full_size": 80764983,
        "id": 16800,
        "repository": 30477,
        "creator": 19526,
        "last_updater": 19526,
        "last_updated": "2016-10-02T05:28:26.479761Z",
        "image_id": null,
        "v2": true,
        "platforms": [
          5
        ]
      },
      {
        "name": "centos-6",
        "full_size": 87937085,
        "id": 16799,
        "repository": 30477,
        "creator": 19526,
        "last_updater": 19526,
        "last_updated": "2016-10-02T05:10:31.492200Z",
        "image_id": null,
        "v2": true,
        "platforms": [
          5
        ]
      },
      {
        "name": "centos-6-1.7.3",
        "full_size": 87937011,
        "id": 5187980,
        "repository": 30477,
        "creator": 19526,
        "last_updater": 19526,
        "last_updated": "2016-10-02T05:08:28.001928Z",
        "image_id": null,
        "v2": true,
        "platforms": [
          5
        ]
      },
      {
        "name": "centos-7-2.1.2",
        "full_size": 80761495,
        "id": 4883130,
        "repository": 30477,
        "creator": 19526,
        "last_updater": 19526,
        "last_updated": "2016-09-16T02:35:23.081813Z",
        "image_id": null,
        "v2": true,
        "platforms": [
          5
        ]
      },
      {
        "name": "centos-6-1.7.2",
        "full_size": 87936969,
        "id": 4883081,
        "repository": 30477,
        "creator": 19526,
        "last_updater": 19526,
        "last_updated": "2016-09-16T02:29:36.208596Z",
        "image_id": null,
        "v2": true,
        "platforms": [
          5
        ]
      },
      {
        "name": "centos-7-2.1.1",
        "full_size": 80761325,
        "id": 4880423,
        "repository": 30477,
        "creator": 19526,
        "last_updater": 19526,
        "last_updated": "2016-09-15T23:00:50.362090Z",
        "image_id": null,
        "v2": true,
        "platforms": [
          5
        ]
      },
      {
        "name": "centos-6-1.7.1",
        "full_size": 87936762,
        "id": 4880263,
        "repository": 30477,
        "creator": 19526,
        "last_updater": 19526,
        "last_updated": "2016-09-15T22:49:35.370223Z",
        "image_id": null,
        "v2": true,
        "platforms": [
          5
        ]
      },
      {
        "name": "centos-7-2.1.0",
        "full_size": 80746023,
        "id": 4538518,
        "repository": 30477,
        "creator": 19526,
        "last_updater": 19526,
        "last_updated": "2016-08-26T23:24:42.379202Z",
        "image_id": null,
        "v2": true,
        "platforms": [
          5
        ]
      }
    ],
    "build_name": "jdeathe/centos-ssh"
  },
  "name": "jdeathe/centos-ssh Docker container",
  "description": "CentOS-6 6.8 x86_64 / CentOS-7 7.2.1511 x86_64 - SCL/EPEL/IUS Repos / Supervisor / OpenSSH.",
  "readme": "centos-ssh\n==========\n\nDocker Images of CentOS-6 6.8 x86_64 / CentOS-7 7.2.1511 x86_64\n\nIncludes public key authentication, Automated password generation and supports custom configuration via environment variables.\n\n## Overview & links\n\nThe latest CentOS-6 / CentOS-7 based releases can be pulled from the centos-6 / centos-7 Docker tags respectively. For a specific release tag the convention is `centos-6-1.5.0` for the [1.5.0](https://github.com/jdeathe/centos-ssh/tree/1.5.0) release tag and `centos-7-2.0.0` for the [2.0.0](https://github.com/jdeathe/centos-ssh/tree/2.0.0) release tag.\n\n- centos-7 [(centos-7/Dockerfile)](https://github.com/jdeathe/centos-ssh/blob/centos-7/Dockerfile)\n- centos-6 [(centos-6/Dockerfile)](https://github.com/jdeathe/centos-ssh/blob/centos-6/Dockerfile)\n\nThe Dockerfile can be used to build a base image that is the bases for several other docker images.\n\nIncluded in the build are the [SCL](https://www.softwarecollections.org/), [EPEL](http://fedoraproject.org/wiki/EPEL) and [IUS](https://ius.io) repositories. Installed packages include [OpenSSH](http://www.openssh.com/portable.html) secure shell, [Sudo](http://www.courtesan.com/sudo/) and [vim-minimal](http://www.vim.org/) are along with python-setuptools, [supervisor](http://supervisord.org/) and [supervisor-stdout](https://github.com/coderanger/supervisor-stdout).\n\n[Supervisor](http://supervisord.org/) is used to start and the sshd daemon when a docker container based on this image is run. To enable simple viewing of stdout for the sshd subprocess, supervisor-stdout is included. This allows you to see output from the supervisord controlled subprocesses with `docker logs {container-name}`.\n\nSSH access is by public key authentication and, by default, the [Vagrant](http://www.vagrantup.com/) [insecure private key](https://github.com/mitchellh/vagrant/blob/master/keys/vagrant) is required.\n\n### SSH Alternatives\n\nSSH is not required in order to access a terminal for the running container. The simplest method is to use the docker exec command to run bash (or sh) as follows:\n\n```\n$ docker exec -it {container-name-or-id} bash\n```\n\nFor cases where access to docker exec is not possible the preferred method is to use Command Keys and the nsenter command. See [command-keys.md](https://github.com/jdeathe/centos-ssh/blob/centos-7/command-keys.md) for details on how to set this up.\n\n## Quick Example\n\n### SSH Mode\n\nRun up an SSH container named 'ssh.pool-1.1.1' from the docker image 'jdeathe/centos-ssh' on port 2020 of your docker host.\n\n```\n$ docker run -d \\\n  --name ssh.pool-1.1.1 \\\n  -p 2020:22 \\\n  jdeathe/centos-ssh:centos-7\n```\n\nCheck the logs for the password (required for sudoËœ).\n\n```\n$ docker logs ssh.pool-1.1.1\n```\n\nDownload the [insecure private key](https://github.com/mitchellh/vagrant/blob/master/keys/vagrant) and set permissions to 600.\n\n```\n$ curl -LSs \\\n  https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant \\\n  > id_rsa_insecure\n$ chmod 600 id_rsa_insecure\n```\n\nConnect using the `ssh` command line client with the [insecure private key](https://github.com/mitchellh/vagrant/blob/master/keys/vagrant).\n\n```\n$ ssh -p 2020 -i id_rsa_insecure \\\n  app-admin@{docker-host-ip}\n```\n\n### SFTP Mode\n\nRun up an SFTP container named 'sftp.pool-1.1.1' from the docker image 'jdeathe/centos-ssh' on port 2021 of your docker host.\n\n```\n$ docker run -d \\\n  --name sftp.pool-1.1.1 \\\n  -p 2021:22 \\\n  -e SSH_USER_FORCE_SFTP=true \\\n  jdeathe/centos-ssh:centos-7\n```\n\nConnect using the `sftp` command line client with the [insecure private key](https://github.com/mitchellh/vagrant/blob/master/keys/vagrant).\n\n```\n$ sftp -p 2021 -i id_rsa_insecure \\\n  app-admin@{docker-host-ip}\n```\n\n## Instructions\n\n### Running\n\nTo run the a docker container from this image you can use the standard docker commands. Alternatively, you can use the embedded (Service Container Manager Interface) [scmi](https://github.com/jdeathe/centos-ssh/blob/centos-7/usr/sbin/scmi) that is included in the image since `centos-6-1.7.2`|`centos-7-2.1.2` or, if you have a checkout of the [source repository](https://github.com/jdeathe/centos-ssh), and have make installed the Makefile provides targets to build, install, start, stop etc. where environment variables can be used to configure the container options and set custom docker run parameters.\n\n#### SCMI Installation Examples\n\nThe following example uses docker to run the SCMI install command to create and start a container named `ssh.pool-1.1.1`. To use SCMI it requires the use of the `--privileged` docker run parameter and the docker host's root directory mounted as a volume with the container's mount directory also being set in the `scmi` `--chroot` option. The `--setopt` option is used to add extra parameters to the default docker run command template; in the following example a named configuration volume is added which allows the SSH host keys to persist after the first container initialisation. Not that the placeholder `{{NAME}}` can be used in this option and is replaced with the container's name.\n\n##### SCMI Install\n\n```\n$ docker run \\\n  --rm \\\n  --privileged \\\n  --volume /:/media/root \\\n  jdeathe/centos-ssh:centos-7-2.1.2 \\\n  /usr/sbin/scmi install \\\n    --chroot=/media/root \\\n    --tag=centos-7-2.1.2 \\\n    --name=ssh.pool-1.1.1 \\\n    --setopt=\"--volume {{NAME}}.config-ssh:/etc/ssh\"\n```\n\n##### SCMI Uninstall\n\nTo uninstall the previous example simply run the same docker run command with the scmi `uninstall` command.\n\n```\n$ docker run \\\n  --rm \\\n  --privileged \\\n  --volume /:/media/root \\\n  jdeathe/centos-ssh:centos-7-2.1.2 \\\n  /usr/sbin/scmi uninstall \\\n    --chroot=/media/root \\\n    --tag=centos-7-2.1.2 \\\n    --name=ssh.pool-1.1.1 \\\n    --setopt=\"--volume {{NAME}}.config-ssh:/etc/ssh\"\n```\n\n##### SCMI Systemd Support\n\nIf your docker host has systemd (and optionally etcd) installed then `scmi` provides a method to install the container as a systemd service unit. This provides some additional features for managing a group of instances on a single docker host and has the option to use an etcd backed service registry. Using a systemd unit file allows the System Administrator to use a Drop-In to override the settings of a unit-file template used to create service instances. To use the systemd method of installation use the `-m` or `--manager` option of `scmi` and to include the optional etcd register companion unit use the `--register` option.\n\n```\n$ docker run \\\n  --rm \\\n  --privileged \\\n  --volume /:/media/root \\\n  jdeathe/centos-ssh:centos-7-2.1.2 \\\n  /usr/sbin/scmi install \\\n    --chroot=/media/root \\\n    --tag=centos-7-2.1.2 \\\n    --name=ssh.pool-1.1.1 \\\n    --manager=systemd \\\n    --register \\\n    --env='SSH_SUDO=\"ALL=(ALL) NOPASSWD:ALL\"' \\\n    --env='SSH_USER=\"centos\"' \\\n    --setopt='--volume {{NAME}}.config-ssh:/etc/ssh'\n```\n\n##### SCMI Fleet Support\n\nIf your docker host has systemd, fleetd (and optionally etcd) installed then `scmi` provides a method to schedule the container  to run on the cluster. This provides some additional features for managing a group of instances on a [fleet](https://github.com/coreos/fleet) cluster and has the option to use an etcd backed service registry. To use the fleet method of installation use the `-m` or `--manager` option of `scmi` and to include the optional etcd register companion unit use the `--register` option.\n\n##### SCMI Image Information\n\nSince release `centos-7-2.1.2` the install template has been added to the image metadata. Using docker inspect you can access `scmi` to simplify install/uninstall tasks.\n\nTo see detailed information about the image run `scmi` with the `--info` option. To see all available `scmi` options run with the `--help` option.\n\n```\n$ eval \"sudo -E $(\n    docker inspect \\\n    -f \"{{.ContainerConfig.Labels.install}}\" \\\n    jdeathe/centos-ssh:centos-7-2.1.2\n  ) --info\"\n```\n\nTo perform an installation using the docker name `ssh.pool-1.2.1` simply use the `--name` or `-n` option.\n\n```\n$ eval \"sudo -E $(\n    docker inspect \\\n    -f \"{{.ContainerConfig.Labels.install}}\" \\\n    jdeathe/centos-ssh:centos-7-2.1.2\n  ) --name=ssh.pool-1.2.1\"\n```\n\nTo uninstall use the *same command* that was used to install but with the `uninstall` Label.\n\n```\n$ eval \"sudo -E $(\n    docker inspect \\\n    -f \"{{.ContainerConfig.Labels.uninstall}}\" \\\n    jdeathe/centos-ssh:centos-7-2.1.2\n  ) --name=ssh.pool-1.2.1\"\n```\n\n##### SCMI on Atomic Host\n\nWith the addition of install/uninstall image labels it is possible to use [Project Atomic's](http://www.projectatomic.io/) `atomic install` command to simplify install/uninstall tasks on [CentOS Atomic](https://wiki.centos.org/SpecialInterestGroup/Atomic) Hosts.\n\nTo see detailed information about the image run `scmi` with the `--info` option. To see all available `scmi` options run with the `--help` option.\n\n```\n$ sudo -E atomic install \\\n  -n ssh.pool-1.3.1 \\\n  jdeathe/centos-ssh:centos-7-2.1.2 \\\n  --info\n```\n\nTo perform an installation using the docker name `ssh.pool-1.3.1` simply use the `-n` option of the `atomic install` command.\n\n```\n$ sudo -E atomic install \\\n  -n ssh.pool-1.3.1 \\\n  jdeathe/centos-ssh:centos-7-2.1.2\n```\n\nAlternatively, you could use the `scmi` options `--name` or `-n` for naming the container.\n\n```\n$ sudo -E atomic install \\\n  jdeathe/centos-ssh:centos-7-2.1.2 \\\n  --name ssh.pool-1.3.1\n```\n\nTo uninstall use the *same command* that was used to install but with the `uninstall` Label.\n\n```\n$ sudo -E atomic uninstall \\\n  -n ssh.pool-1.3.1 \\\n  jdeathe/centos-ssh:centos-7-2.1.2\n```\n\n#### Using environment variables\n\nThe following example overrides the default \"app-admin\" SSH username and home directory path with \"app-user\" and \"/home/app-user\" respectively. The same technique could also be applied to set the SSH_USER_PASSWORD value.\n\n*Note:* Settings applied by environment variables will override those set within configuration volumes from release 1.3.1. Existing installations that use the sshd-bootstrap.conf saved on a configuration \"data\" volume will not allow override by the environment variables. Also users can update sshd-bootstrap.conf to prevent the value being replaced by that set using the environment variable.\n\n```\n$ docker stop ssh.pool-1.1.1 \\\n  && docker rm ssh.pool-1.1.1 \\\n  ; docker run -d \\\n  --name ssh.pool-1.1.1 \\\n  -p :22 \\\n  --env \"SSH_USER=app-user\" \\\n  jdeathe/centos-ssh:centos-7\n```\n\nNow you can find out the app-admin, (sudoer), user's password by inspecting the container's logs\n\n```\n$ docker logs ssh.pool-1.1.1\n```\n\nThe output of the logs should show the auto-generated password for the app-admin and root users, (if not try again after a few seconds).\n\n```\n2016-02-01 02:26:51,420 CRIT Supervisor running as root (no user in config file)\n2016-02-01 02:26:51,420 WARN Included extra file \"/etc/supervisord.d/sshd-bootstrap.conf\" during parsing\n2016-02-01 02:26:51,420 WARN Included extra file \"/etc/supervisord.d/sshd.conf\" during parsing\n2016-02-01 02:26:51,420 WARN No file matches via include \"/etc/supervisord.d/*.ini\"\n2016-02-01 02:26:51,422 INFO supervisord started with pid 1\n2016-02-01 02:26:52,425 INFO spawned: 'supervisor_stdout' with pid 7\n2016-02-01 02:26:52,427 INFO spawned: 'sshd-bootstrap' with pid 8\n2016-02-01 02:26:52,429 INFO spawned: 'sshd' with pid 9\n2016-02-01 02:26:52,458 INFO success: sshd-bootstrap entered RUNNING state, process has stayed up for > than 0 seconds (startsecs)\n2016-02-01 02:26:53,956 INFO success: supervisor_stdout entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)\n2016-02-01 02:26:53,957 INFO success: sshd entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)\nsshd-bootstrap stdout | Initialising SSH.\nsshd-bootstrap stdout |\n================================================================================\nSSH Details\n--------------------------------------------------------------------------------\nuser : app-user\npassword : QDQE12uVMyagLEsQ\nid : 500:500\nhome : /home/app-user\nchroot path : N/A\nshell : /bin/bash\nsudo : ALL=(ALL) ALL\nkey fingerprints :\ndd:3b:b8:2e:85:04:06:e9:ab:ff:a8:0a:c0:04:6e:d6 (insecure key)\nrsa host key fingerprint :\n96:a3:f6:d7:32:d7:a5:38:f8:49:2c:5e:53:e4:86:30\n--------------------------------------------------------------------------------\n\nsshd stdout | Server listening on 0.0.0.0 port 22.\nsshd stdout | Server listening on :: port 22.\n2016-02-01 02:26:54,464 INFO exited: sshd-bootstrap (exit status 0; expected)\n```\n\n#### Environment Variables\n\nThere are several environmental variables defined at runtime these allow the operator to customise the running container.\n\n##### SSH_AUTHORIZED_KEYS\n\nAs detailed below the public key added for the SSH user is insecure by default. This is intentional and allows for access using a known private key. Using `SSH_AUTHORIZED_KEYS` you can replace the insecure public key with another one (or several). Further details on how to create your own private + public key pair are provided below. If adding more than one key it is recommended to base64 encode the value.\n\n```\n...\n--env \"SSH_AUTHORIZED_KEYS=\nssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key\nssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAqmLedI2mEJimvIm1OzT1EYJCMwegL/jfsXARLnYkZvJlEHFYDmRgS+YQ+MA9PKHyriCPmVNs/6yVc2lopwPWioXt0+ulH/H43PgB6/4fkP0duauHsRtpp7z7dhqgZOXqdLUn/Ybp0rz0+yKUOBb9ggjE5n7hYyDGtZR9Y11pJ4TuRHmL6wv5mnj9WRzkUlJNYkr6X5b6yAxtQmX+2f33u2qGdAwADddE/uZ4vKnC0jFsv5FdvnwRf2diF/9AagDb7xhZ9U3hPOyLj31H/OUce4xBpGXRfkUYkeW8Qx+zEbEBVlGxDroIMZmHJIknBDAzVfft+lsg1Z06NCYOJ+hSew== another public key\n\"  \\\n...\n```\n\n*Note:* The `base64` command on Mac OSX will encode a file without line breaks by default but if using the command on Linux you need to include use the `-w` option to prevent wrapping lines at 80 characters. i.e. `base64 -w 0 -i {key-path}`.\n\n```\n...\n  --env \"SSH_AUTHORIZED_KEYS=$(\n    cat ${HOME}/.ssh/id_rsa.pub ${HOME}/.ssh/another_id_rsa.pub | base64 -i -\n  )\" \\\n...\n```\n\n##### SSH_AUTOSTART_SSHD & SSH_AUTOSTART_SSHD_BOOTSTRAP\n\nIt may be desirable to prevent the startup of the sshd daemon and/or sshd-bootstrap script. For example, when using an image built from this Dockerfile as the source for another Dockerfile you could disable both sshd and sshd-booststrap from startup by setting `SSH_AUTOSTART_SSHD` and `SSH_AUTOSTART_SSHD_BOOTSTRAP` to `false`. The benefit of this is to reduce the number of running processes in the final container.\n\n```\n...\n  --env \"SSH_AUTOSTART_SSHD=false\" \\\n  --env \"SSH_AUTOSTART_SSHD_BOOTSTRAP=false\" \\\n...\n```\n\n##### SSH_CHROOT_DIRECTORY\n\nThis option is only applicable when `SSH_USER_FORCE_SFTP` is set to `true`. When using the using the SFTP option the user is jailed into the ChrootDirectory. The value can contain the placeholders `%h` and `%u` which will be replaced with the values of `SSH_USER_HOME` and `SSH_USER` respectively. The default value of `%h` is the best choice in most cases but the user requires a sub-directory in their HOME directory which they have write access to. If no volume is mounted into the path of the SSH user's HOME directory the a directory named `_data` is created automatically. If you need the user to be able to write to their HOME directory they use an alternative value such as `/chroot/%u` so that the user's HOME path, (relative to the ChrootDirectory), becomes `/chroot/app-admin/home/app-admin` by default.\n\n```\n...\n  --env \"SSH_CHROOT_DIRECTORY=%h\" \\\n...\n```\n\n##### SSH_INHERIT_ENVIRONMENT\n\nThe SSH user's environment is reset by default meaning that the Docker environmental variables are not available. Use `SSH_INHERIT_ENVIRONMENT` to allow the Docker environment variables to be passed to the SSH user's environment. Note that some values are removed to prevent issues; such as SSH_USER_PASSWORD, HOME, HOSTNAME, PATH, TERM etc.\n\n```\n...\n  --env \"SSH_INHERIT_ENVIRONMENT=true\" \\\n...\n```\n\n##### SSH_SUDO\n\nOn first run the SSH user is created with a the sudo rule `ALL=(ALL)  ALL` which allows the user to run all commands but a password is required. If you want to limit the access to specific commands or allow sudo without a password prompt `SSH_SUDO` can be used.\n\n```\n...\n  --env \"SSH_SUDO=ALL=(ALL) NOPASSWD:ALL\" \\\n...\n```\n\n##### SSH_USER\n\nOn first run the SSH user is created with the default username of \"app-admin\". If you require an alternative username `SSH_USER` can be used when running the container.\n\n```\n...\n  --env \"SSH_USER=app-1\" \\\n...\n```\n\n##### SSH_USER_FORCE_SFTP\n\nTo force the use of the internal-sftp command set `SSH_USER_FORCE_SFTP` to `true`. This will prevent shell access, remove the ability to use `sudo` and restrict the user to the ChrootDirectory set using `SSH_SHROOT_DIRECTORY`. Using SFTP in combination with --volumes-from another running container can be used to allow write access to an applications data volume - for example using the `SSH_USER_HOME` value to `/var/www/` could be used to allow access to the data volume of an Apache container.\n\n```\n...\n  --env \"SSH_USER_FORCE_SFTP=false\" \\\n...\n```\n\n##### SSH_USER_HOME\n\nOn first run the SSH user is created with the default HOME directory of `/home/%u` where `%u` is replaced with the value of `SSH_USER`. If you require an alternative HOME directory `SSH_USER_HOME` can be used when running the container.\n\n```\n...\n  --env \"SSH_USER_HOME=/home/app-1\" \\\n...\n```\n\n##### SSH_USER_PASSWORD\n\nOn first run the SSH user is created with a generated password. If you require a specific password `SSH_USER_PASSWORD` can be used when running the container. If set to an empty string then a password is auto-generated and, if `SSH_SUDO` is not set to allow no password for all commands, will be displayed in the docker logs.\n\n```\n...\n  --env \"SSH_USER_PASSWORD=Passw0rd!\" \\\n...\n```\n\n##### SSH_USER_PASSWORD_HASHED\n\nIf setting a password for the SSH user you might not want to store the plain text password value in the `SSH_USER_PASSWORD` environment variable. Setting `SSH_USER_PASSWORD_HASHED` to `true` indicates that the value stored in `SSH_USER_PASSWORD` should be treated as a crypt SHA-512 salted password hash.\n\n```\n...\n  --env \"SSH_USER_PASSWORD_HASHED=true\" \\\n  --env 'SSH_USER_PASSWORD=$6$pepper$g5/OhofGtHVo3wqRgVHFQrJDyK0mV9bDpF5HP964wuIkQ7MXuYq1KRTmShaUmTQW3ZRsjw2MjC1LNPh5HMcrY0'\n...\n```\n\n###### Generating a crypt SHA-512 password hash\n\nTo generate a new hashed password string you can use the following method - given a password of \"Passw0rd!\" and a salt of \"pepper\".\n\n```\n$ docker exec -it ssh.pool-1.1.1 \\\n  env \\\n  PASSWORD=Passw0rd! \\\n  PASSWORD_SALT=pepper \\\n  python -c \"import crypt,os; print crypt.crypt(os.environ.get('PASSWORD'), '\\$6\\$' + os.environ.get('PASSWORD_SALT') + '\\$')\"\n```\n\nThe result should be the string: ```$6$pepper$g5/OhofGtHVo3wqRgVHFQrJDyK0mV9bDpF5HP964wuIkQ7MXuYq1KRTmShaUmTQW3ZRsjw2MjC1LNPh5HMcrY0```\n\n##### SSH_USER_SHELL\n\nOn first run the SSH user is created with a default shell of \"/bin/bash\". If you require a specific shell `SSH_USER_SHELL` can be used when running the container. You could use \"/sbin/nologin\" to prevent login with the user account.\n\n```\n...\n  --env \"SSH_USER_SHELL=/bin/sh\" \\\n...\n```\n\n##### SSH_USER_ID\n\nUse `SSH_USER_ID` to set a specific UID:GID for the `SSH_USER`. The values should be 500 or more - the default being 500:500. This may be useful when running an SFTP container and mounting data volumes from an existing container.\n\n```\n...\n  --env \"SSH_USER_ID=500:500\" \\\n...\n```\n\n### Connect to the running container using SSH\n\nIf you have not already got one, create the .ssh directory in your home directory with the permissions required by SSH.\n\n```\n$ mkdir -pm 700 ~/.ssh\n```\n\nGet the [Vagrant](http://www.vagrantup.com/) insecure public key using curl (you could also use wget if you have that installed).\n\n```\n$ curl -LsSO https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant && \\\n  mv vagrant ~/.ssh/id_rsa_insecure && \\\n  chmod 600 ~/.ssh/id_rsa_insecure\n```\n\nIf the command ran successfully you should now have a new private SSH key installed in your home \"~/.ssh\" directory called \"id_rsa_insecure\"\n\nNext, unless we specified one, we need to determine what port to connect to on the docker host. You can do this with either `docker ps` or `docker inspect` but the simplest method is to use `docker port`.\n\n```\n$ docker port ssh.pool-1.1.1 22\n```\n\nTo connect to the running container use:\n\n```\n$ ssh -p {container-port} \\\n  -i ~/.ssh/id_rsa_insecure \\\n  app-admin@{docker-host-ip} \\\n  -o StrictHostKeyChecking=no\n```\n",
  "dockerfile": "# =============================================================================\n# jdeathe/centos-ssh\n#\n# CentOS-7 7.2.1511 x86_64 - SCL/EPEL/IUS Repos. / Supervisor / OpenSSH.\n# \n# =============================================================================\nFROM centos:centos7.2.1511\n\nMAINTAINER James Deathe <james.deathe@gmail.com>\n\n# -----------------------------------------------------------------------------\n# Import the RPM GPG keys for Repositories\n# -----------------------------------------------------------------------------\nRUN rpm --import \\\n\t\thttp://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-7 \\\n\t&& rpm --import \\\n\t\thttps://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7 \\\n\t&& rpm --import \\\n\t\thttps://dl.iuscommunity.org/pub/ius/IUS-COMMUNITY-GPG-KEY\n\n# -----------------------------------------------------------------------------\n# Base Install\n# -----------------------------------------------------------------------------\nRUN rpm --rebuilddb \\\n\t&& yum -y install \\\n\t\tcentos-release-scl \\\n\t\tcentos-release-scl-rh \\\n\t\tepel-release \\\n\t\thttps://centos7.iuscommunity.org/ius-release.rpm \\\n\t\tvim-minimal-7.4.160-1.el7 \\\n\t\txz-5.1.2-12alpha.el7.x86_64 \\\n\t\tsudo-1.8.6p7-17.el7_2 \\\n\t\topenssh-6.6.1p1-25.el7_2 \\\n\t\topenssh-server-6.6.1p1-25.el7_2 \\\n\t\topenssh-clients-6.6.1p1-25.el7_2 \\\n\t\tpython-setuptools-0.9.8-4.el7 \\\n\t\tyum-plugin-versionlock-1.1.31-34.el7 \\\n\t&& yum versionlock add \\\n\t\tvim-minimal \\\n\t\txz \\\n\t\tsudo \\\n\t\topenssh \\\n\t\topenssh-server \\\n\t\topenssh-clients \\\n\t\tpython-setuptools \\\n\t\tyum-plugin-versionlock \\\n\t&& rm -rf /var/cache/yum/* \\\n\t&& yum clean all\n\n# -----------------------------------------------------------------------------\n# Install supervisord (required to run more than a single process in a container)\n# Note: EPEL package lacks /usr/bin/pidproxy\n# We require supervisor-stdout to allow output of services started by \n# supervisord to be easily inspected with \"docker logs\".\n# -----------------------------------------------------------------------------\nRUN easy_install \\\n\t\t'supervisor == 3.3.1' \\\n\t\t'supervisor-stdout == 0.1.1' \\\n\t&& mkdir -p \\\n\t\t/var/log/supervisor/\n\n# -----------------------------------------------------------------------------\n# UTC Timezone & Networking\n# -----------------------------------------------------------------------------\nRUN ln -sf \\\n\t\t/usr/share/zoneinfo/UTC \\\n\t\t/etc/localtime \\\n\t&& echo \"NETWORKING=yes\" > /etc/sysconfig/network\n\n# -----------------------------------------------------------------------------\n# Configure SSH for non-root public key authentication\n# -----------------------------------------------------------------------------\nRUN sed -i \\\n\t-e 's~^PasswordAuthentication yes~PasswordAuthentication no~g' \\\n\t-e 's~^#PermitRootLogin yes~PermitRootLogin no~g' \\\n\t-e 's~^#UseDNS yes~UseDNS no~g' \\\n\t-e 's~^\\(.*\\)/usr/libexec/openssh/sftp-server$~\\1internal-sftp~g' \\\n\t/etc/ssh/sshd_config\n\n# -----------------------------------------------------------------------------\n# Enable the wheel sudoers group\n# -----------------------------------------------------------------------------\nRUN sed -i \\\n\t-e 's~^# %wheel\\tALL=(ALL)\\tALL~%wheel\\tALL=(ALL) ALL~g' \\\n\t-e 's~\\(.*\\) requiretty$~#\\1requiretty~' \\\n\t/etc/sudoers\n\n# -----------------------------------------------------------------------------\n# Copy files into place\n# -----------------------------------------------------------------------------\nADD usr/sbin \\\n\t/usr/sbin/\nADD opt/scmi \\\n\t/opt/scmi/\nADD etc/systemd/system \\\n\t/etc/systemd/system/\nADD etc/services-config/ssh/authorized_keys \\\n\tetc/services-config/ssh/sshd-bootstrap.conf \\\n\tetc/services-config/ssh/sshd-bootstrap.env \\\n\t/etc/services-config/ssh/\nADD etc/services-config/supervisor/supervisord.conf \\\n\t/etc/services-config/supervisor/\nADD etc/services-config/supervisor/supervisord.d \\\n\t/etc/services-config/supervisor/supervisord.d/\n\nRUN mkdir -p \\\n\t\t/etc/supervisord.d/ \\\n\t&& cp -pf \\\n\t\t/etc/ssh/sshd_config \\\n\t\t/etc/services-config/ssh/ \\\n\t&& ln -sf \\\n\t\t/etc/services-config/ssh/sshd_config \\\n\t\t/etc/ssh/sshd_config \\\n\t&& ln -sf \\\n\t\t/etc/services-config/ssh/sshd-bootstrap.conf \\\n\t\t/etc/sshd-bootstrap.conf \\\n\t&& ln -sf \\\n\t\t/etc/services-config/ssh/sshd-bootstrap.env \\\n\t\t/etc/sshd-bootstrap.env \\\n\t&& ln -sf \\\n\t\t/etc/services-config/supervisor/supervisord.conf \\\n\t\t/etc/supervisord.conf \\\n\t&& ln -sf \\\n\t\t/etc/services-config/supervisor/supervisord.d/sshd-wrapper.conf \\\n\t\t/etc/supervisord.d/sshd-wrapper.conf \\\n\t&& ln -sf \\\n\t\t/etc/services-config/supervisor/supervisord.d/sshd-bootstrap.conf \\\n\t\t/etc/supervisord.d/sshd-bootstrap.conf \\\n\t&& chmod 700 \\\n\t\t/usr/sbin/{scmi,sshd-{bootstrap,wrapper}}\n\n# -----------------------------------------------------------------------------\n# Purge\n# -----------------------------------------------------------------------------\nRUN rm -rf /etc/ld.so.cache \\\n\t; rm -rf /sbin/sln \\\n\t; rm -rf /usr/{{lib,share}/locale,share/{man,doc,info,cracklib,i18n},{lib,lib64}/gconv,bin/localedef,sbin/build-locale-archive} \\\n\t; rm -rf /{root,tmp,var/cache/{ldconfig,yum}}/* \\\n\t; > /etc/sysconfig/i18n\n\nEXPOSE 22\n\n# -----------------------------------------------------------------------------\n# Set default environment variables\n# -----------------------------------------------------------------------------\nENV SSH_AUTHORIZED_KEYS=\"\" \\\n\tSSH_AUTOSTART_SSHD=true \\\n\tSSH_AUTOSTART_SSHD_BOOTSTRAP=true \\\n\tSSH_CHROOT_DIRECTORY=\"%h\" \\\n\tSSH_INHERIT_ENVIRONMENT=false \\\n\tSSH_SUDO=\"ALL=(ALL) ALL\" \\\n\tSSH_USER=\"app-admin\" \\\n\tSSH_USER_FORCE_SFTP=false \\\n\tSSH_USER_HOME=\"/home/%u\" \\\n\tSSH_USER_ID=\"500:500\" \\\n\tSSH_USER_PASSWORD=\"\" \\\n\tSSH_USER_PASSWORD_HASHED=false \\\n\tSSH_USER_SHELL=\"/bin/bash\"\n\n# -----------------------------------------------------------------------------\n# Set image metadata\n# -----------------------------------------------------------------------------\nARG RELEASE_VERSION=\"2.1.3\"\nLABEL \\\n\tinstall=\"docker run \\\n--rm \\\n--privileged \\\n--volume /:/media/root \\\njdeathe/centos-ssh:centos-7-${RELEASE_VERSION} \\\n/usr/sbin/scmi install \\\n--chroot=/media/root \\\n--name=\\${NAME} \\\n--tag=centos-7-${RELEASE_VERSION} \\\n--setopt='--volume {{NAME}}.config-ssh:/etc/ssh'\" \\\n\tuninstall=\"docker run \\\n--rm \\\n--privileged \\\n--volume /:/media/root \\\njdeathe/centos-ssh:centos-7-${RELEASE_VERSION} \\\n/usr/sbin/scmi uninstall \\\n--chroot=/media/root \\\n--name=\\${NAME} \\\n--tag=centos-7-${RELEASE_VERSION} \\\n--setopt='--volume {{NAME}}.config-ssh:/etc/ssh'\" \\\n\torg.deathe.name=\"centos-ssh\" \\\n\torg.deathe.version=\"${RELEASE_VERSION}\" \\\n\torg.deathe.release=\"jdeathe/centos-ssh:centos-7-${RELEASE_VERSION}\" \\\n\torg.deathe.license=\"MIT\" \\\n\torg.deathe.vendor=\"jdeathe\" \\\n\torg.deathe.url=\"https://github.com/jdeathe/centos-ssh\" \\\n\torg.deathe.description=\"CentOS-7 7.2.1511 x86_64 - SCL, EPEL and IUS Repositories / Supervisor / OpenSSH.\"\n\nCMD [\"/usr/bin/supervisord\", \"--configuration=/etc/supervisord.conf\"]",
  "dockerfile_json": {
    "add": [
      {
        "source": "usr/sbin",
        "dest": "\t/usr/sbin/"
      },
      {
        "source": "opt/scmi",
        "dest": "\t/opt/scmi/"
      },
      {
        "source": "etc/systemd/system",
        "dest": "\t/etc/systemd/system/"
      },
      {
        "source": "etc/services-config/ssh/authorized_keys",
        "dest": "\tetc/services-config/ssh/sshd-bootstrap.conf"
      },
      {
        "source": "etc/services-config/supervisor/supervisord.conf",
        "dest": "\t/etc/services-config/supervisor/"
      },
      {
        "source": "etc/services-config/supervisor/supervisord.d",
        "dest": "\t/etc/services-config/supervisor/supervisord.d/"
      }
    ],
    "expose": [
      22
    ],
    "volume": [],
    "run": [
      "rpm --import \t\thttp://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-7 \t&& rpm --import \t\thttps://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7 \t&& rpm --import \t\thttps://dl.iuscommunity.org/pub/ius/IUS-COMMUNITY-GPG-KEY",
      "rpm --rebuilddb \t&& yum -y install \t\tcentos-release-scl \t\tcentos-release-scl-rh \t\tepel-release \t\thttps://centos7.iuscommunity.org/ius-release.rpm \t\tvim-minimal-7.4.160-1.el7 \t\txz-5.1.2-12alpha.el7.x86_64 \t\tsudo-1.8.6p7-17.el7_2 \t\topenssh-6.6.1p1-25.el7_2 \t\topenssh-server-6.6.1p1-25.el7_2 \t\topenssh-clients-6.6.1p1-25.el7_2 \t\tpython-setuptools-0.9.8-4.el7 \t\tyum-plugin-versionlock-1.1.31-34.el7 \t&& yum versionlock add \t\tvim-minimal \t\txz \t\tsudo \t\topenssh \t\topenssh-server \t\topenssh-clients \t\tpython-setuptools \t\tyum-plugin-versionlock \t&& rm -rf /var/cache/yum/* \t&& yum clean all",
      "easy_install \t\t'supervisor == 3.3.1' \t\t'supervisor-stdout == 0.1.1' \t&& mkdir -p \t\t/var/log/supervisor/",
      "ln -sf \t\t/usr/share/zoneinfo/UTC \t\t/etc/localtime \t&& echo \"NETWORKING=yes\" > /etc/sysconfig/network",
      "sed -i \t-e 's~^PasswordAuthentication yes~PasswordAuthentication no~g' \t-e 's~^#PermitRootLogin yes~PermitRootLogin no~g' \t-e 's~^#UseDNS yes~UseDNS no~g' \t-e 's~^\\(.*\\)/usr/libexec/openssh/sftp-server$~\\1internal-sftp~g' \t/etc/ssh/sshd_config",
      "sed -i \t-e 's~^# %wheel\\tALL=(ALL)\\tALL~%wheel\\tALL=(ALL) ALL~g' \t-e 's~\\(.*\\) requiretty$~#\\1requiretty~' \t/etc/sudoers",
      "mkdir -p \t\t/etc/supervisord.d/ \t&& cp -pf \t\t/etc/ssh/sshd_config \t\t/etc/services-config/ssh/ \t&& ln -sf \t\t/etc/services-config/ssh/sshd_config \t\t/etc/ssh/sshd_config \t&& ln -sf \t\t/etc/services-config/ssh/sshd-bootstrap.conf \t\t/etc/sshd-bootstrap.conf \t&& ln -sf \t\t/etc/services-config/ssh/sshd-bootstrap.env \t\t/etc/sshd-bootstrap.env \t&& ln -sf \t\t/etc/services-config/supervisor/supervisord.conf \t\t/etc/supervisord.conf \t&& ln -sf \t\t/etc/services-config/supervisor/supervisord.d/sshd-wrapper.conf \t\t/etc/supervisord.d/sshd-wrapper.conf \t&& ln -sf \t\t/etc/services-config/supervisor/supervisord.d/sshd-bootstrap.conf \t\t/etc/supervisord.d/sshd-bootstrap.conf \t&& chmod 700 \t\t/usr/sbin/{scmi,sshd-{bootstrap,wrapper}}",
      "rm -rf /etc/ld.so.cache \t; rm -rf /sbin/sln \t; rm -rf /usr/{{lib,share}/locale,share/{man,doc,info,cracklib,i18n},{lib,lib64}/gconv,bin/localedef,sbin/build-locale-archive} \t; rm -rf /{root,tmp,var/cache/{ldconfig,yum}}/* \t; > /etc/sysconfig/i18n"
    ],
    "workdir": [],
    "from": "centos:centos7.2.1511",
    "maintainer": "James Deathe <james.deathe@gmail.com>",
    "env": {
      "SSH_AUTHORIZED_KEYS": "\"\"",
      "\tSSH_AUTOSTART_SSHD": "true",
      "\tSSH_AUTOSTART_SSHD_BOOTSTRAP": "true",
      "\tSSH_CHROOT_DIRECTORY": "\"%h\"",
      "\tSSH_INHERIT_ENVIRONMENT": "false",
      "\tSSH_SUDO": "\"ALL",
      "(ALL)": "ALL\"",
      "\tSSH_USER": "\"app-admin\"",
      "\tSSH_USER_FORCE_SFTP": "false",
      "\tSSH_USER_HOME": "\"/home/%u\"",
      "\tSSH_USER_ID": "\"500:500\"",
      "\tSSH_USER_PASSWORD": "\"\"",
      "\tSSH_USER_PASSWORD_HASHED": "false",
      "\tSSH_USER_SHELL": "\"/bin/bash\""
    },
    "arg": "RELEASE_VERSION=\"2.1.3\"",
    "label": "\tinstall=\"docker run --rm --privileged --volume /:/media/root jdeathe/centos-ssh:centos-7-${RELEASE_VERSION} /usr/sbin/scmi install --chroot=/media/root --name=\\${NAME} --tag=centos-7-${RELEASE_VERSION} --setopt='--volume {{NAME}}.config-ssh:/etc/ssh'\" \tuninstall=\"docker run --rm --privileged --volume /:/media/root jdeathe/centos-ssh:centos-7-${RELEASE_VERSION} /usr/sbin/scmi uninstall --chroot=/media/root --name=\\${NAME} --tag=centos-7-${RELEASE_VERSION} --setopt='--volume {{NAME}}.config-ssh:/etc/ssh'\" \torg.deathe.name=\"centos-ssh\" \torg.deathe.version=\"${RELEASE_VERSION}\" \torg.deathe.release=\"jdeathe/centos-ssh:centos-7-${RELEASE_VERSION}\" \torg.deathe.license=\"MIT\" \torg.deathe.vendor=\"jdeathe\" \torg.deathe.url=\"https://github.com/jdeathe/centos-ssh\" \torg.deathe.description=\"CentOS-7 7.2.1511 x86_64 - SCL, EPEL and IUS Repositories / Supervisor / OpenSSH.\"",
    "cmd": "[\"/usr/bin/supervisord\", \"--configuration=/etc/supervisord.conf\"]"
  },
  "source_repository_url": "https://github.com/jdeathe/centos-ssh.git",
  "source_repository_type": "git",
  "source_repository_provider": "github",
  "source_repository_web_url": "https://github.com/jdeathe/centos-ssh",
  "docker_repository": "jdeathe/centos-ssh",
  "docker_image": "jdeathe/centos-ssh",
  "parameters_schema": {
    "SSH_AUTHORIZED_KEYS": {
      "default": "\"\"",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_AUTOSTART_SSHD": {
      "default": "true",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_AUTOSTART_SSHD_BOOTSTRAP": {
      "default": "true",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_CHROOT_DIRECTORY": {
      "default": "\"%h\"",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_INHERIT_ENVIRONMENT": {
      "default": "false",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_SUDO": {
      "default": "\"ALL",
      "type": "string",
      "mapping": "environment_variable"
    },
    "(ALL)": {
      "default": "ALL\"",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_USER": {
      "default": "\"app-admin\"",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_USER_FORCE_SFTP": {
      "default": "false",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_USER_HOME": {
      "default": "\"/home/%u\"",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_USER_ID": {
      "default": "\"500:500\"",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_USER_PASSWORD": {
      "default": "\"\"",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_USER_PASSWORD_HASHED": {
      "default": "false",
      "type": "string",
      "mapping": "environment_variable"
    },
    "\tSSH_USER_SHELL": {
      "default": "\"/bin/bash\"",
      "type": "string",
      "mapping": "environment_variable"
    },
    "exposed_ports": {
      "default": [
        22
      ],
      "type": "json_array"
    }
  },
  "type": "docker",
  "docker_name": "jdeathe/centos-ssh",
  "revision": "centos-7",
  "uris": [
    "https://hub.docker.com/r/jdeathe/centos-ssh",
    "https://hub.docker.com/v2/repositories/jdeathe/centos-ssh",
    "https://github.com/jdeathe/centos-ssh.git"
  ],
  "labels": [
    "Docker",
    "Binding/Region/North America/US",
    "Type/Infrastructure/Operating System/Linux/CentOS"
  ],
  "info_url": "https://hub.docker.com/r/jdeathe/centos-ssh",
  "requires": [
    {
      "kind": "host",
      "label": "Docker Engine"
    }
  ],
  "latest": true,
  "gatherbase_origin": "docker-hub"
}