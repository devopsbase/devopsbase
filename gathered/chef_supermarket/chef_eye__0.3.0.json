{
  "name": "chef_eye Chef cookbook",
  "chef_cookbook_name": "chef_eye",
  "revision": "0.3.0",
  "uris": [
    "https://supermarket.chef.io/cookbooks/chef_eye",
    "https://supermarket.chef.io/cookbooks/chef_eye/download",
    "https://supermarket.chef.io/cookbooks/chef_eye/versions/0.3.0",
    "https://supermarket.chef.io/cookbooks/chef_eye/versions/0.3.0/download",
    "https://supermarket.chef.io/api/v1/cookbooks/chef_eye/versions/0.3.0",
    "https://supermarket.chef.io/api/v1/cookbooks/chef_eye",
    "https://supermarket.chef.io/api/v1/cookbooks/chef_eye/versions/0.3.0/download"
  ],
  "labels": [
    "Chef cookbook",
    "Other",
    "Executable/Script/Chef Cookbook",
    "Mode/Executable/Script/Chef Cookbook"
  ],
  "info_url": "https://supermarket.chef.io/cookbooks/chef_eye",
  "package_url": "https://supermarket.chef.io/api/v1/cookbooks/chef_eye/versions/0.3.0/download",
  "deprecated": false,
  "created": "2015-01-03T21:59:17.846Z",
  "updated": "2016-01-13T10:09:56.306Z",
  "description": "Installs/Configures chef_eye",
  "maintainer": {
    "name": "nikolaymurga",
    "email": "nikolay.m@randrmusic.com"
  },
  "license": "Apache v2.0",
  "chef_foodcritic_failure": false,
  "chef_up_for_adoption": null,
  "rating": null,
  "followers_count": 0,
  "downloads_count": 2337850,
  "downloads_count_revision": 397616,
  "repository_url": "https://github.com/MurgaNikolay/chef-eye",
  "issues_url": "https://github.com/MurgaNikolay/chef-eye/issues",
  "chef_source_url": "https://github.com/MurgaNikolay/chef-eye",
  "gatherbase_origin": "chef-supermarket",
  "readme_name": "README.md",
  "readme": "# chef_eye\n\nCookbook for setup [eye](https://github.com/kostya/eye) service and applications\n\n## Supported Platforms\n\n* Ubuntu 12.04\n* Ubuntu 14.04\n\n## Attributes\n\n\n| Key | Type | Description | Default |\n|-----|------|-------------|---------|\n| chef_eye.eye_bin | String  |  Path to eye executable file | /usr/local/bin/eye |\n| chef_eye.leye_bin | String  |  Path to local eye executable file | /usr/local/bin/leye |\n| chef_eye.services | Hash or Array  |  Array of users or Hash with users as keys and service options as value | ['root'] |\n| chef_eye.applications | Hash  | Applications configurations | {} |\n| chef_eye.install_ruby | Boolean  | Try to install ruby packages `ruby`, `ruby-dev`. If you want to install ruby using another way, you should set this value to `false` | true |\n\n\n## Usage\n\nThis cookbook provides two strategies. \"Eye\" per user and \"eye\" per project (local eye).\nFirst strategy run one eye daemon for all configurations and load it.\n\nEye per user file structure:\n\n    /etc/init.d/eye_vagrant # Eye service for user vagrant (generated by chef_eye::service recipe)\n    /etc/eye/vagrant/_config.eye # Main service configuration (generated by chef_eye::service recipe)\n    /etc/eye/vagrant/application1.eye # Application config (generated by chef_eye_application lwrp)\n    /etc/eye/vagrant/application2.eye\n    /etc/eye/vagrant/*.eye\n\n\n\nEye per project (local eye) file structure (generated by `chef_eye_application_local` lwrp):\n\n    /etc/init.d/leye_application1\n    /var/www/application1/.eye # Eye home\n    /var/www/application1/.eye/Eyefile # Local eye configuration\n    /var/www/application1/.eye/leye # Wrapper for leye with environment variables\n    /var/www/application1/.eye/sock\n    /var/www/application1/.eye/pid\n\n## Recipes\n\n### chef_eye::default\n\nInclude `chef_eye` in your node's `run_list`:\n\n```json\n{\n  \"run_list\": [\n    \"recipe[chef_eye::default]\"\n  ]\n}\n```\n\n### chef_eye::ruby\n\nCookbook used system ruby and try to install `ruby`, `ruby-dev` packages if `node['chef_eye']['install_ruby']` set to `true`\nIf  you want to use custom system ruby, you need set `node['chef_eye']['install_ruby']` to `false` and install custom ruby before\nbefore this cookbook. For example, if you want to use `uid` and `gid` [application options](https://github.com/kostya/eye/issues/50),\nyou need install ruby 2.0.0 as system ruby. Its installation is your concern.\n\n## chef_eye::service\n\nThis recipe generate service for eye daemons per users\n\nServices named by `eye_` prefix and username. For example, service for user vagrant, well be named as `eye_vagrant`, service for user root as `eye_root`, etc.\n\nIf you need to reload service for user `vagrant`, you can use\n\n    some_resource do\n      ...\n      notifies :reload, 'service[eye_vagrant]'\n    end\n\nif you want to configure service fore some user, you can setup it\n\n    default['chef_eye']['services'] = {\n      ubuntu: {\n        'logger' => '/var/log/eye/ubuntu.log'\n        'mail' => {\n          'host' => 'mx.some.host',\n          'port' => 25,\n          'domain' => 'some.host'\n        },\n        contacts: {\n          'errors' => {\n            'type' => 'mail',\n            'contact' => 'error@some.host'\n          },\n          'dev' => {\n            'type' => 'mail',\n            'contact' => 'error@some.host',\n            'opts' => {}\n          },\n        }\n      }\n    }\n\n### chef_eye::applications\n\nThis service generate `chef_eye_application` or `chef_eye_application_local` LWRP's using `node['chef_eye']['applications']` attributes.\nYou can use any valid eye [options](https://github.com/kostya/eye/tree/master/examples). For example:\n\n    default['chef_eye']['applications']['my_app'] = {\n      owner: 'vagrant', # required\n      group: 'vagrant',\n      working_dir: '/var/www/my_app',\n      checks: {\n        cpu: {\n          :every => 30,\n          :below => 80,\n          :times => 3\n        },\n        memory:{\n          :every => 30,\n          :below => 73400320,\n          :times => [ 3, 5 ]\n        }\n      },\n      process: {\n        unicorn: {\n          daemonize:  true,\n          pid_file: 'puma.pid',\n          stdall: 'puma.log',\n          start_command: 'bundle exec unicorn --port 33280 --environment production Config.ru',\n          stop_signals: ['TERM', 5, 'KILL']\n        },\n        resque: {\n          pid_file: 'tmp/pids/resque.pid',\n          start_command: 'bin/resque work --queue=high',\n          checks: {\n            cpu: {\n              :every => 30,\n              :below => 80,\n              :times => 3\n            }\n          }\n        }\n      }\n    }\n\nThis cookbook will install the eye service for user 'vagrant' (`/etc/init.d/eye_vagrant`) and generate valid '.eye' configuration file\n(`/etc/eye/vagrant/my_app.eye`).\n\nApplication used local eye version have additional attributes.\n\n\n      {\n        type: 'local' # <- Configure application using leye\n        eye_home: '/var/www/my_app/shared/.eye', #eye home, default eye_home = working_dir\n        eye_config: {}, # leye daemon configuration\n        eye_pid: 'pid', # absolute or relative path to pidfile\n        eye_socket:'sock', # absolute or relative path to socket\n\n        owner: 'vagrant', # required\n        group: 'vagrant',\n        working_dir: '/var/www/my_app',\n        ....\n      }\n\n## LWRP\n\n### chef_eye_application\n\n#### Attributes:\n\n|  Name       |  Type  | Description  |  Default Value |\n|-------------|--------|--------------|----------------|\n|  owner      | String | Username. This is required attribute |    None, *required*    |\n|  config     | Hash or Block | Application configuration, see example    |    None, *required*  |\n|  group      | String | Group    |     |\n|  cookbook   | String | Cookbook name for searching templates    | \"chef_eye\"    |\n|  helper   | TrueClass,FalseClass | This flag enable creation of helper script     | true    |\n|  helper_prefix   | String, NilClass | Prefix of helper script    | nil    |\n\n\nCookbook provide `chef_eye_application` resource. This is a main resource for generate eye configuration.\n\n    chef_eye_application 'name_of_my_app' do\n      owner 'ubuntu'\n      group 'ubuntu'\n      working_dir '/var/www/my_app'\n      config do\n        env 'RAILS_ENV' => 'production'\n        working_dir '/var/www/my_app'\n        trigger :flapping, :times => 10, :within => 1.minute\n        process :puma do\n          daemonize true\n          pid_file \"puma.pid\"\n          stdall \"puma.log\"\n          start_command \"bundle exec puma --port 33280 --environment production thin.ru\"\n          stop_signals [:TERM, 5.seconds, :KILL]\n          restart_command \"kill -USR2 {PID}\"\n          restart_grace 10.seconds\n          check :cpu, :every => 30, :below => 80, :times => 3\n          check :memory, :every => 30, :below => 70.megabytes, :times => [3,5]\n        end\n      end\n      action :configure # or :delete\n      notifies :reload, 'service[eye_ubuntu]' # you need notify service for reload\n    end\n\nor as hash\n\n    chef_eye_application 'name_of_my_app' do\n      owner 'ubuntu'\n      group 'ubuntu'\n      config({\n          env: {\n            RAILS_ENV: 'production'\n          },\n          working_dir: '/var/www/my_app',\n          triggers: {\n            flapping: {\n              :times => 10,\n              :within => 1.minute\n            }\n          },\n          processes: {\n            puma: {\n              daemonize: true,\n              pid_file: \"puma.pid\",\n              stdall: \"puma.log\",\n              start_command: \"bundle exec puma --port 33280 --environment production thin.ru\",\n              stop_signals: [:TERM, 5.seconds, :KILL],\n              restart_command: \"kill -USR2 {PID}\",\n              restart_grace: 10.seconds,\n              checks: {\n                cpu: {:every => 30, :below => 80, :times => 3},\n                memory: {:every => 30, :below => 70.megabytes, :times => [3, 5]}\n              }\n            }\n          }\n        })\n      action :configure # or :delete\n      notifies :reload, 'service[eye_ubuntu]' # you need notify service for reload\n    end\n\n### chef_eye_application_local\n\nThis lwrp generate config for leye and create init.d service for local eye daemon.\nConfiguration for application writes to Eyefile.\n\n#### Attributes:\n\n|  Name       |  Type  | Description  |  Default Value |\n|-------------|--------|--------------|----------------|\n|  owner      | String | Username. This is required attribute |    None, *required*    |\n|  config     | Hash or Block | Application configuration, see example    |    None, *required*  |\n|  group      | String | Group    |     |\n|  cookbook   | String | Cookbook name for searching templates    | \"chef_eye\"    |\n|  eye_config     | Hash or Block | leye daemon configuration     |    nil  |\n|  eye_home   | String |               |  woring_dir              |\n|  eye_file   | String |  Name or path to Eyefile | \"Eyefile\"                |\n|  eye_pid    | String |  Name or path to pidfile  | \"pid\"               |\n|  eye_socket | String |  Name or path to eye socket | \"sock\"                |\n|  log_file   | String |  Relative or absolute path to logfile | \"/var/log/eye/**owner**/eye.log\" |\n\n\n### Helpers\n\n`chef_eye_application` resource have `helper` (String) and `helper_prefix` (String, default: owner name) attributes. If helper is true, resource will generate `/usr/local/sbin/<prefix>_<application_name>` executable scripts. By default for `my_app` helper is `/usr/local/sbin/vagrant_my_app`. This script run all command only for `my_app` namespace. `chef_eye_application_local` have helper too. For `my_app` this helper will be named like  `/usr/local/sbin/leye_my_app` but this is symlink to `leye` wrapper from `<eye_home>/leye`\n\n## License and Authors\n\nAuthor:: Nikolay Murga (nikolay.m@randrmusic.com)\n\n\n",
  "requires": [
    {
      "kind": "host",
      "label": "ubuntu",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "debian",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    }
  ],
  "chef_recipes": {
    "chef_eye": "Installs all"
  }
}