{
  "name": "certificate Chef cookbook",
  "chef_cookbook_name": "certificate",
  "revision": "1.0.0",
  "uris": [
    "https://supermarket.chef.io/cookbooks/certificate",
    "https://supermarket.chef.io/cookbooks/certificate/download",
    "https://supermarket.chef.io/cookbooks/certificate/versions/1.0.0",
    "https://supermarket.chef.io/cookbooks/certificate/versions/1.0.0/download",
    "https://supermarket.chef.io/api/v1/cookbooks/certificate/versions/1.0.0",
    "https://supermarket.chef.io/api/v1/cookbooks/certificate",
    "https://supermarket.chef.io/api/v1/cookbooks/certificate/versions/1.0.0/download"
  ],
  "labels": [
    "Chef cookbook",
    "Other",
    "Executable/Script/Chef Cookbook",
    "Mode/Executable/Script/Chef Cookbook",
    "Mode/Executable/Bundle"
  ],
  "info_url": "https://supermarket.chef.io/cookbooks/certificate",
  "package_url": "https://supermarket.chef.io/api/v1/cookbooks/certificate/versions/1.0.0/download",
  "deprecated": false,
  "created": "2012-03-15T18:22:02.000Z",
  "updated": "2015-04-06T15:05:41.608Z",
  "description": "Installs/Configures certificates, private keys, CA root bundles from encrypted data bags.",
  "maintainer": {
    "name": "atomic-penguin",
    "email": "eric.wolfe@gmail.com"
  },
  "license": "Apache 2.0",
  "chef_foodcritic_failure": false,
  "chef_up_for_adoption": null,
  "rating": null,
  "followers_count": 41,
  "downloads_count": 24202598,
  "downloads_count_revision": 274051,
  "repository_url": "http://github.com/atomic-penguin/cookbook-certificate",
  "issues_url": "http://github.com/atomic-penguin/cookbook-certificate",
  "chef_source_url": "http://github.com/atomic-penguin/cookbook-certificate",
  "latest": true,
  "gatherbase_origin": "chef-supermarket",
  "readme_name": "README.md",
  "readme": "Certificate cookbook\n====================\n\n[![Build Status](https://secure.travis-ci.org/atomic-penguin/cookbook-certificate.png?branch=master)](http://travis-ci.org/atomic-penguin/cookbook-certificate)\n\nDescription\n-----------\n\nThis recipe automates the common task of managing x509 certificates and keys\nfrom encrypted Data Bags.  This cookbook provides a flexible and re-usable\nLWRP which can be plugged into other recipes, such as the postfix or apache2\ncookbooks.\n\n#### Warning about Vault mode\n\nVault mode is not supported in chef-solo, and will result in a failure condition.  One needs\nto select either encrypted, or unencrypted, `data_bag_type` for use with chef-solo.\n\n#### Testing with encrypted data_bags\n\nThe KITCHEN.md is a reference document for testing encrypted data_bags with test-kitchen.\nThe stub files in`test/integration` are used to validate the `certificate_manage` library.\nThese stub files in `test/integration` should not be used in production.  These files include\nself-signed \"snake oil\" certificate/key and an `encrypted_data_bag_secret` file\nwhich are not secure to use beyond testing.\n\nRequirements\n------------\n\nYou do need to prepare an encrypted data bag, containing the certificates,\nprivate keys, and CA bundles you wish to deploy to servers with the LWRP.\nI used Joshua Timberman's [blog post](http://jtimberman.housepub.org/blog/2011/08/06/encrypted-data-bag-for-postfix-sasl-authentication/),\nand the Opscode [Wiki documentation](https://wiki.opscode.com/display/chef10/Encrypted+Data+Bags)\nas a reference in creating this cookbook.\n\nFirst, create a **data bag secret** as follows.  You need to manually copy\nthe *encrypted_data_bag_secret* to */etc/chef* on your servers, or place it\nthere as part of your bootstrap process.  For example, you may choose to\ndo deploy the secret file with kickstart or preseed as part of the OS\ninstall process.\n\n    openssl rand -base64 512 > ~/.chef/encrypted_data_bag_secret\n\nSecond, create a data bag, the default data bag within the LWRP is\nnamed *certificates*.  However, you may override this with the\n*data_bag* LWRP attribute.\n\n    knife data bag create certificates\n\nYou need to convert your certificate, private keys, and CA bundles into\nsingle-line blobs with literal `\\n` characters.  This is so it may be\ncopy/pasted into your data bag. You can use `sed` or you can use a Perl \nor Ruby one-liner for this conversion.\n\n    cat <filename> | sed s/$/\\\\\\\\n/ | tr -d '\\n'\n    -OR-\n    /usr/bin/env ruby -e 'p ARGF.read' <filename>\n    -OR-\n    perl -pe 's!(\\x0d)?\\x0a!\\\\n!g' <filename>\n\nWhat we're trying to accomplish is converting this:\n\n    -----BEGIN CERTIFICATE-----\n    MIIEEDCCA3mgAwIBAgIJAO4rOcmpIFmPMA0GCSqGSIb3DQEBBQUAMIG3MQswCQYD\n    -----END CERTIFICATE-----\n\nInto this:\n\n    -----BEGIN CERTIFICATE-----\\nMIIEEDCCA3mgAwIBAgIJAO4rOcmpIFmPMA0GCSqGSIb3DQEBBQUAMIG3MQswCQYD\\n-----END CERTIFICATE-----\n\nFinally, you'll want to create the data bag object to contain your certs,\nkeys, and optionally your CA root chain bundle.  The default recipe uses\nthe OHAI attribute *hostname* as a *search_id*.  One can use an *fqdn* as the *search_id*.\nOlder versions of Knife have a strict character filter list which prevents the use of `.`\nseparators in data bag IDs.\n\nThe cookbook also contains an example *wildcard* recipe to use with wildcard\ncertificates (\\*.example.com) certificates.\n\nHostname mail as data bag search_id:\n\n    knife data bag create certificates mail --secret-file ~/.chef/encrypted_data_bag_secret\n\nThe resulting encrypted data bag for a hostname should be structured like so.\nThe *chain* id may be optional if your CA's root chain is already trusted by the\nserver.\n\n    {\n      \"id\": \"mail\",\n      \"cert\": \"-----BEGIN CERTIFICATE-----\\nMail Certificate Here...\",\n      \"key\": \"-----BEGIN PRIVATE KEY\\nMail Private Key Here...\",\n      \"chain\": \"-----BEGIN CERTIFICATE-----\\nCA Root Chain Here...\"\n    }\n\n\nWildcard certificate as data bag search_id:\n\n    knife data bag create certificates wildcard --secret-file ~/.chef/encrypted_data_bag_secret\n\nThe resulting encrypted data bag should be structured like so for a wildcard\ncertificate.  The *chain* id may be optional if your CA's root chain is already\ntrusted by the server.\n\n    {\n      \"id\": \"wildcard\",\n      \"cert\": \"-----BEGIN CERTIFICATE-----\\nWildcard Certificate Here...\",\n      \"key\": \"-----BEGIN PRIVATE KEY\\nWildcard Private Key Here...\",\n      \"chain\": \"-----BEGIN CERTIFICATE-----\\nCA Root Chain Here...\"\n    }\n\n\nRecipes\n-------\n\nThis cookbook comes with three simple example recipes for using the *certificate_manage* LWRP.\n\n#### default\n\nSearches the data bag, *certificates*, for an object with an *id* matching\n*node.hostname*.  Then the recipe places the decrypted certificates and keys\nin either */etc/pki/tls* (RHEL family), or */etc/ssl* (Debian family).  The\ndefault owner and group owner of the resulting files are *root*.\n\nThe resulting files will be named {node.fqdn}.pem (cert),\n{node.fqdn}.key (key), and {node.hostname}-bundle.crt (CA Root chain).\n\n#### wildcard\n\nSame as the default recipe, except for the search *id* is *wildcard*.\nThe resulting files will be named wildcard.pem (cert), wildcard.key (key),\nand wildcard-bundle.crt (CA Root chain)\n\n### manage_by_attributes\n\nRetrieve search keys from attributes \"certificate\".\nSet ID and LWRP attributes to node attribute following...\n\n    \"certificate\": [\n      {\"self\": null},\n      {\"mail\": {\n        \"cert_path\": \"/etc/postfix/ssl\",\n         \"owner\": \"postfix\",\n         \"group\": \"postfix\"\n        }\n      },\n    ]\n\n\nResources/Providers\n-------------------\n\n#### resources\n\nThe LWRP resource attributes are as follows.\n\n  * `data_bag` - Data bag index to search, defaults to certificates\n  * `data_bag_secret` - Path to the file with the data bag secret\n  * `data_bag_type` - encrypted, unencrypted, vault\n    - vault type data bags are not supported with chef-solo\n  * `search_id` - Data bag id to search for, defaults to provider name\n  * `cert_path` - Top-level SSL directory, defaults to vendor specific location\n  * `cert_file` - The basename of the x509 certificate, defaults to {node.fqdn}.pem\n  * `key_file` - The basename of the private key file, defaults to {node.fqdn}.key\n  * `chain_file` - The basename of the x509 certificate, defaults to {node.hostname}-bundle.crt\n  * `nginx_cert` - If `true`, combines server and CA certificates for nginx. Default `false`\n  * `combined_file` - If `true`, combines server cert, CA cert and private key into a single file. Default `false`\n  * `owner` - The file owner, defaults to root\n  * `group` - The file group owner, defaults to root\n  * `cookbook` - The cookbook containing the erb template, defaults to certificate\n  * `create_subfolders` - Enable/disable auto-creation of private/certs subdirectories.  Defaults to true\n\n#### providers\n\n  * `certificate_manage` - The reusable LWRP to manage certificates, keys, and CA bundles\n\nUsage\n-----\n\nHere is a flushed out example using the LWRP to manage your certificate\nitems on a Postfix bridgehead.  The following example should select the\n*mail* data bag object, from the *certificates* data bag.\n\nIt should then place the managed certificate files in */etc/postfix/ssl*,\nand change the owner/group to *postfix*.\n\n```ruby\ncertificate_manage \"mail\" do\n  cert_path \"/etc/postfix/ssl\"\n  owner \"postfix\"\n  group \"postfix\"\nend\n```\n\n##### .certificate, .key, .chain helper method usage\n\nSome helper methods are exposed for retrieving key/certificate paths in other recipes:\n\n  * `.certificate` - The final path of the certificate file. i.e. `#{cert_path}/certs/#{cert_file}`\n  * `.key` - The final path of the key file. i.e. `#{cert_path}/private/#{key_file}`\n  * `.chain` - The final path of the chain file. i.e. `#{cert_path}/certs/#{chain_file}`\n\n```rb\n# where node.fqdn = 'example.com'\ntld = certificate_manage 'top_level_domain'\ntld_cert_location = tld.certificate # => /etc/ssl/certs/example.com.pem\n\n# where node.fqdn = 'sub.example.com'\nsbd = certificate_manage 'sub_domain' do\n  cert_path '/bobs/emporium'\n  create_subfolders false\nend\nsbd_cert_location = sbd.key # => /bobs/emporium/sub.example.com.key\n```\n\n##### Setting FQDN during the converge?\n\nIf you are updating the FQDN of the node during converge, be sure to use [lazy attribute evaluation](https://docs.chef.io/resource_common.html#lazy-attribute-evaluation) when using the LWRP to ensure ```node['fqdn']``` refers to the updated value.\n\n```ruby\ncertificate_manage \"wildcard\" do\n  cert_file lazy { \"#{node['fqdn']}.pem\" }\n  key_file lazy { \"#{node['fqdn']}.key\" }\n  chain_file lazy { \"#{node['fqdn']}-bundle.crt\" }\nend\n```\n\nLicense and Author\n------------------\n\nAuthor:: Eric G. Wolfe <eric.wolfe@gmail.com> [![endorse](https://api.coderwall.com/atomic-penguin/endorsecount.png)](https://coderwall.com/atomic-penguin)\n\nCopyright:: 2012, Eric G. Wolfe\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n",
  "requires": [
    {
      "kind": "host",
      "label": "amazon",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "centos",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "debian",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "fedora",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "redhat",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "oracle",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "scientific",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "ubuntu",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "smartos",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "env",
      "uri": "https://supermarket.chef.io/cookbooks/chef-vault",
      "revision": ">= 0.0.0",
      "self_resolve": true
    }
  ]
}