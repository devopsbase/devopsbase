{
  "name": "dirsrv Chef cookbook",
  "chef_cookbook_name": "dirsrv",
  "revision": "0.1.0",
  "uris": [
    "https://supermarket.chef.io/cookbooks/dirsrv",
    "https://supermarket.chef.io/cookbooks/dirsrv/download",
    "https://supermarket.chef.io/cookbooks/dirsrv/versions/0.1.0",
    "https://supermarket.chef.io/cookbooks/dirsrv/versions/0.1.0/download",
    "https://supermarket.chef.io/api/v1/cookbooks/dirsrv/versions/0.1.0",
    "https://supermarket.chef.io/api/v1/cookbooks/dirsrv",
    "https://supermarket.chef.io/api/v1/cookbooks/dirsrv/versions/0.1.0/download"
  ],
  "labels": [
    "Chef cookbook",
    "Applications",
    "Executable/Script/Chef Cookbook",
    "Mode/Executable/Script/Chef Cookbook"
  ],
  "info_url": "https://supermarket.chef.io/cookbooks/dirsrv",
  "package_url": "https://supermarket.chef.io/api/v1/cookbooks/dirsrv/versions/0.1.0/download",
  "deprecated": false,
  "created": "2014-08-12T03:15:30.062Z",
  "updated": "2016-05-24T04:36:42.623Z",
  "description": "Installs and configures 389 Directory Server",
  "maintainer": {
    "name": "sundiata",
    "email": "alwillis@riotgames.com"
  },
  "license": "All rights reserved",
  "chef_foodcritic_failure": true,
  "chef_up_for_adoption": false,
  "rating": null,
  "followers_count": 1,
  "downloads_count": 2207909,
  "downloads_count_revision": 1096162,
  "repository_url": "https://github.com/RiotGames/dirsrv-cookbook",
  "issues_url": "https://github.com/RiotGames/dirsrv-cookbook/issues",
  "chef_source_url": "https://github.com/RiotGames/dirsrv-cookbook",
  "gatherbase_origin": "chef-supermarket",
  "readme_name": "README.md",
  "readme": "# dirsrv cookbook\n\nInstalls and configures 389 Directory Server\n\nFrom http://port389.org:\n\n*\"The enterprise-class Open Source LDAP server for Linux. It is hardened by real-world use, is full-featured, supports multi-master replication, and already handles many of the largest LDAP deployments in the world. The 389 Directory Server can be downloaded for free and set up in less than an hour using the graphical console.\"*\n\n__... or even faster using Chef :)__\n\n## Yum cookbook / EPEL repository\n\nFor RHEL based systems, the yum cookbook can be used to install the software packages from the [EPEL repo](https://fedoraproject.org/wiki/EPEL). Just set the 'use_yum_epel' flag to true.\n\n```\ndefault[:dirsrv][:use_yum_epel] = false\ndefault[:dirsrv][:packages] = %w{389-ds}\n```\n\n## Sysctls \n\nThe following sysctls are recommended for 389DS. You may want to tune these to values appropriate to your system.\n\n- fs.file_max = 64000\n- net.ipv4.tcp_keepalive_time = 30\n- net.ipv4.ip_local_port_range = '1024 65000'\n\n## Resources\n\n### dirsrv_instance\n\n  Configures a 389 Directory Server instance. See [this installation guide](http://www.centos.org/docs/5/html/CDS/install/8.0/Installation_Guide-Preparing_for_a_Directory_Server_Installation-Installation_Overview.html) for more details.\n\nName | Description | Type | Default\n-----|-------------|------|----------\ninstance | The name for the instance which must be unique to the system. You can have multiple instances running on the same system | String | Name Attribute\nsuffix | This is the name of the root of the instance's LDAP heirarchy | String \ncredentials | See the 'Credentials' section below | String or Hash | 'default'\nhost | The hostname that should be used to create the instance. This must include at least one dot ('.') so as to appear to be an FQDN. | String | node[:fqdn]\nport | The port that this instance will listen on. | Integer | 389\nadd_org_entries | 389DS comes with a suggested skeleton directory structure. Set this to true if you want it | Boolean | false\nadd_sample_entries | 389DS comes with a set of sample top level entries. Set this to true if you want it | Boolean | false\npreseed_ldif | If you would like to preseed your directory server with an LDIF file, specify the path the file here | String |\nconf_dir | The directory that contains configuration files for all of the 389DS instances on a system. | String | '/etc/dirsrv'\nbase_dir | The directory that contains the application data for the 389DS service. | String | '/var/lib/dirsrv'\n\nThe Administration server is an httpd service that can be installed alongside the directory server to enable remote administration ( e.g. starting and stopping the service, managing ssl certificates, configuring replication, editing ldap entries). You can designate one particular node to run an admin service that also acts as a 'Configuration Directory' in 389DS parlance. Connecting to the admin service on a configuration directory node allows you to see and manage all of the directories who have registered their presence with the config directory. The following options will enable you to configure this. \n\nName | Description | Type | Default\n-----|-------------|------|----------\ncfgdir_domain | The name of the configuration directory domain. See 389DS docs. | String\ncfgdir_credentials | See the 'Credentials' section below | String \ncfgdir_addr | The ip address that this service should listen on | String | node[:ipaddress]\ncfgdir_http_port | The http port that the admin service should listen on | 9830\ncfgdir_ldap_port | The ldap port for the instance that the admin console service is running on | Integer | 389\nis_cfgdir | Set to true if the instance is the config directory | Boolean | false\nhas_cfgdir | Set to true if the instance should register with a config directory | Boolean | false\n\n__ACTIONS__\n* __create__\n* start\n* stop\n* restart\n\n### dirsrv_entry\n\nAfter the initial setup of the directory server, all subsequent configuration can be accomplished by manipulating LDAP entries in the directory itself. This resource is used to manage generic LDAP entries. It makes use of the ruby net-ldap library, and can be used with any LDAP directory service.\n\nName | Description | Type | Default\n-----|-------------|------|----------\ndn | Distinguished Name (DN) | String | Name Attribute\nattributes | Attributes to be set on the entry. Existing attributes of the same name will have their contents replaced | Hash \nappend_attributes | Attributes whose values are to be appended to any existing values, if any | Hash\nseed_attributes | Attributes whose values are to be set once and not modified again | Hash\nprune | List of attributes to be removed, or a Hash of attributes with specific values to be removed | Array or Hash \nhost | The host to connect to | String | localhost\nport | The port to connect to | Integer | 389\ncredentials | See the 'Credentials' section below | String or Hash | 'default'\ndatabag_name | The databag that will be used to lookup the credentials data bag item | String | The name of the calling cookbook\n\n__ACTIONS__\n* __create__\n* delete\n\n__*The resources below all make use of this one to create objects in the directory server. This means that they also require the 'host', 'port', 'credentials' and 'databag_name' parameters which are simply passed through to this resource. Omitting these common parameters from the resource descriptions below for brevity*__\n\n### dirsrv_config\n\nConfigure attributes of the directory server instance itself. The configuration file for the directory server instance is a file called 'dse.ldif' in the instance specific config directory under /etc/dirsrv. This ldif object is loaded upon startup and is best modified at runtime. This resource modifies the attributes of the 'cn=config' ldap entry. You can find a full list of the configuration options available by using \"ldapsearch -x -b cn=config -s base -D 'cn=Directory Manager' -W\".\n\nName | Description | Type | Default\n-----|-------------|------|----------\nattr | The name of the attribute to be modified | String | Name Attribute\nvalue | The value(s) to be set | String or Array |\n\n__ACTIONS__\n* __enable__\n* disable\n\n### dirsrv_plugin\n\nModify the plugins available to the directory server. To get a full list of the plugins available, use the following command: \"ldapsearch -x -b cn=plugins,cn=config -s one -D 'cn=Directory Manager' -W cn dn\"\n\nName | Description | Type | Default\n-----|-------------|------|----------\ncommon_name | The name of the plugin, including spaces | String | Name Attribute\nattributes | The attributes/values to be set. See dirsrv_entry | Hash\nappend_attributes | The attributes/values to be appended to any existing values. See dirsrv_entry | Hash\n\n__ACTIONS__\n* __enable__\n* disable\n* modify\n\n### dirsrv_index\n\nCreates an index on an attribute.\n\nName | Description | Type | Default\n-----|-------------|------|----------\nname | The attribute to be indexed | String | Name Attribute\ndatabase | Name of the underlying BDB database | String | 'userRoot'\nequality | Will this index be used to compare string equality? | Boolean | false\npresence | Will this index be used to compare string presence? | Boolean | false\nsubstring | Will this index be used to perform substring matches? | Boolean | false\n\n__ACTIONS__\n* __create__\n\n### dirsrv_user\n\nCreates a user for various kinds of identity management purposes. This is useful to create users who can bind (connect) and use the LDAP instance. It can also be used to create users with posix attributes on them for use with UNIX systems.\n\nName | Description | Type | Default\n-----|-------------|------|----------\ncommon_name | Value to be set as both uid and cn attributes. See relativedn_attribute | String  | Name Attribute\nsurname | The surname of the user. Should be set on accounts that will be used by people | String | Matches the value of common_name.\npassword | Optional password should be specified in plaintext. Will be converted to a salted sha (SSHA) hash before being sent to the directory | String \nhome | home directory. Required for posix accounts | String\nshell | login shell. Required for posix accounts. | String\nbasedn | The DN that will be the parent of the user account entry ( e.g. 'ou=people,... ). Required | String\nrelativedn_attribute | The relative distinguished name (RDN) attribute. This is will be used to name the common_name attribute from above. Given a common_name of 'bjensen' and a basedn attribute of 'ou=people,o=myorg,c=US' the distinguished name would be 'uid=bjensen,ou=people,o=myorg,c=US'. | 'uid'\nuid_number | Required for posix accounts. If not supplied, the basedn will be searched for the highest value and the next increment will be used | Integer | 1000\ngid_number | Required for posix accounts. If not supplied, the basedn will be searched for the highest value and the next increment will be used | Integer | 1000\nis_person | Will this be used by a person? | Boolean | true\nis_posix | Will this be used on a posix system? | Boolean | true\nis_extensible | Can the entry be extended using custom attributes? | Boolean | false\n\n__ACTIONS__\n* __create__\n* delete\n\n### dirsrv_replica\n\nA replica object is used to describe the role that the directory instance will play in a replication scheme. Replication documentation can be found [here](https://access.redhat.com/documentation/en-US/Red_Hat_Directory_Server/9.0/html/Administration_Guide/Managing_Replication.html)\n\nName | Description | Type | Default\n-----|-------------|------|----------\nsuffix | root of ldap tree. See disrv_instance | String | Name Attribute\ninstance | name of the instance corresponding to the suffix | String\nid | unique replica id | Integer | Generated from ip address. See below.\nrole | role that this replica plays in the replication scheme | Integer | See below\npurge_delay | See nsDS5ReplicaPurgeDelay in documentation | Integer | 604800\nbase_dir | See dirsrv_instance | String | '/var/lib/dirsrv'\n\n__ACTIONS__\n* __create__\n\nReplica IDs must be unique among all participants in a replication scheme. It is best if they are unique among all of the systems you plan to administer, so that you don't have to worry about overlap should you decide to reorient your replication scheme in the future. If not specified, the id will be generated from the hosts ip address by bitshifting the 4th octet eight bits to the left and adding the second octet.\n\n```\nsecond = node[:ipaddress].split('.').slice(1).to_i\nfourth = node[:ipaddress].split('.').slice(3).to_i\nreplid = new_resource.id.nil? ? (( fourth << 8 ) + second ).to_s : new_resource.id.to_s\n```\n\nReplication roles must be one of the following: __:single_master__ __:multi_master__ __:hub__ and __:consumer__\n\nDocumentation about these roles can be found [here](https://access.redhat.com/documentation/en-US/Red_Hat_Directory_Server/9.0/html/Deployment_Guide/Designing_the_Replication_Process.html)\n\n### dirsrv_agreement\n\nReplication Agreements are used to describe a one-way direction for data to be pushed from supplier to consumer. Multiple agreements can be configured on a supplier to push the same set of data to multiple consumers. To accomplish bidirectional synchronization for multi-master replication, there must be two agreements in place, one for each node pushing data to each other, so a node participating in a __:multi_master__ role is both a supplier and a consumer of the dataset that it holds. \n\nIn order to publish this data, each participating replica must have a DN to bind to that lies outside of the replicated dataset. Typically this replication bind dn is located at 'cn=Replication Manager,cn=config'. The *_vagrant_replication* recipe contains an example of how to use dirsrv_user to create this DN.\n\nPlease refer to the [documentation](https://access.redhat.com/documentation/en-US/Red_Hat_Directory_Server/9.0/html/Administration_Guide/Managing_Replication-Configuring-Replication-cmd.html) which covers the attributes used to configure both replicas and replication agreements.\n\nAdditionally, 389 Directory Server is able to synchronize with Active Directory and this resource can be used to create agreements with AD hosts as well.\n\nName | Description | Type | Default\n-----|-------------|------|----------\nlabel | label must have characters that can be used in an LDAP DN | String | Name Attribute\nsuffix | see dirsrv_instance | String\ndirectory_type | 389DS or Active Directory | __:AD__ or __:DS__ | __:DS__\nreplica_host | The remote host that will be a consumer for this data | Integer |\nreplica_port | The port of the consumer replica | Integer | 389\nreplica_bind_dn | Bind DN for replication | String | 'cn=Replication Manager,cn=config'\nreplica_update_schedule | Corresponds to nsDS5ReplicaUpdateSchedule | String | '0000-2359 0123456'\nreplica_bind_method | Corresponds to nsDS5ReplicaBindMethod | String | 'SIMPLE'\nreplica_transport | Corresponds to nsDS5ReplicaTransportInfo | String | 'LDAP'\nreplica_credentials | Corresponds to nsDS5ReplicaBindCredentials for AD, nsDS5ReplicaCredentials for DS | String | \nds_replicated_attribute_list  | Corresponds to nsDS5ReplicatedAttributeList | String | '(objectclass=*) $ EXCLUDE authorityRevocationList accountUnlockTime memberof'\nds_replicated_attribute_list_total | Corresponds to nsDS5ReplicatedAttributeListTotal | String | '(objectclass=*) $ EXCLUDE accountUnlockTime'\nad_domain | Active Directory Domain (nsDS7WindowsDomain) | String \nad_new_user_sync | Corresponds to nsDS7NewWinUserSyncEnabled | String\nad_new_group_sync | Corresponds to nsDS7NewWinGroupSyncEnabled | String\nad_one_way_sync | Corresponds to oneWaySync | String\nad_sync_interval | Corresponds to winSyncInterval | Integer\nad_sync_move_action | Corresponds to winSyncMoveAction | 'none', 'delete', 'unsync' | 'none'\nad_replica_subtree | The Active Directory suffix to be replicated to 389DS (nsDS7WindowsReplicaSubtree) | String | \n\n__ACTIONS__\n* __create__\n* create_and_initialize\n\nInitialization is an action that replaces the data in the current replica with the data in another replica. Since 389 has push-model replication, the process to setup multi-master replication should take the following steps:\n\n1. Create the first replica on node A. For the purposes of demonstration, create a few entries on this replica to represent an existing dataset.\n2. Create the second replica on node B.\n3. Create an agreement on node B to push updates to node A. Since there is no data on the freshly created B, it has no updates to send.\n4. Create an agreement on node A to push updates to node B __*and initialize it upon creation*__. Now B will have the dataset that was on A, and it will be able to publish any updates back to A using the agreement created in step 3.\n\nIf we are to introduce any additional nodes to this setup, we would have them request to be initialized from one designated node ( say node A ) and simply create agreements pointing to and from all of the other nodes within the replication scheme.\n\nTo see a real working example of this, check out the recipes named *___vagrant_xxx__* or simply 'vagrant up'\n\n## Credentials\n\nThe 'credentials' attribute found on many of these resources provides a way to use credentials stored in a databag. It can either be a Hash object with the keys defined below, or a String. If this specified a String, it will look for a databag whose name matches the calling cookbook and pull out an item whose name matches the 'credentials' string. This data bag item should have the Hash keys described below. If no credentials are specified, it will look for a data bag item called 'default_credentials'.  \n\nkey      | value | example\n---------|-------|--------\nuserdn   | The bind DN used to initialize the instance and create the initial set of LDAP entries | 'cn=Directory Manager' |\npassword | The password, in plain text | 'Super Cool Passwords Are Super Cool!!!!!'\nuser     | Used by the admin_credentials attribute to setup the 389 admin server | 'manager'\n\nYou can specify userdn or user, or both of them if you want the user of the Admin Server to have the same password as the Directory Manager. Of course, you can have many different sets of credentials.\n\n## Examples\n\nThe included Vagrantfile and vagrant specific recipes are used to spin up a test environment demonstrating four-way multi-master replication, a proxy/hub and a consumer.  These recipes can be used as a template for use in your wrapper cookbooks. You can read more about various cookbook patterns on Jamie's [blog](http://blog.vialstudios.com/the-environment-cookbook-pattern)\n\n## TODO\n\n* Register admin server with a remote configuration directory a la register-ds-admin\n* Certificate management and replication via ssl\n* Add schema files and create schema reload task\n\n## Supports\n\nThis cookbook is tested and works on CentOS 6.x and it should also work on other RHEL derivatives that can use the EPEL repo. It is also tested and working on recent Ubuntu distributions. It should also work for Debian systems, but the 389-ds packages seem to only be available for Debian sid (unstable).\n\n# Author\n\nAuthor:: Alan Willis (<alwillis@riotgames.com>)\n\n# License\n\nSee LICENSE for license details\n",
  "requires": [
    {
      "kind": "host",
      "label": "centos",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "fedora",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "oracle",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "redhat",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "scientific",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "debian",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "host",
      "label": "ubuntu",
      "revision": ">= 0.0.0",
      "one_of_group": "os"
    },
    {
      "kind": "env",
      "uri": "https://supermarket.chef.io/cookbooks/yum",
      "revision": "~> 3.0",
      "self_resolve": true
    },
    {
      "kind": "env",
      "uri": "https://supermarket.chef.io/cookbooks/hostsfile",
      "revision": ">= 0.0.0",
      "self_resolve": true
    }
  ]
}