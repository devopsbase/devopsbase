{
  "name": "echa-oracle Chef cookbook",
  "chef_cookbook_name": "echa-oracle",
  "revision": "1.0.2",
  "uris": [
    "https://supermarket.chef.io/cookbooks/echa-oracle",
    "https://supermarket.chef.io/cookbooks/echa-oracle/download",
    "https://supermarket.chef.io/cookbooks/echa-oracle/versions/1.0.2",
    "https://supermarket.chef.io/cookbooks/echa-oracle/versions/1.0.2/download",
    "https://supermarket.chef.io/api/v1/cookbooks/echa-oracle/versions/1.0.2",
    "https://supermarket.chef.io/api/v1/cookbooks/echa-oracle",
    "https://supermarket.chef.io/api/v1/cookbooks/echa-oracle/versions/1.0.2/download"
  ],
  "labels": [
    "Chef cookbook",
    "Databases",
    "Executable/Script/Chef Cookbook",
    "Mode/Executable/Script/Chef Cookbook",
    "Type/Infrastructure/Operating System/Linux/CentOS"
  ],
  "info_url": "https://supermarket.chef.io/cookbooks/echa-oracle",
  "package_url": "https://supermarket.chef.io/api/v1/cookbooks/echa-oracle/versions/1.0.2/download",
  "deprecated": false,
  "created": "2013-07-10T12:48:20.000Z",
  "updated": "2013-07-22T20:31:21.000Z",
  "description": "Installs/Configures Oracle on CentOS 6.4",
  "maintainer": {
    "name": "aririikonen",
    "email": "chef-oss@echa.europa.eu"
  },
  "license": "Apache 2.0",
  "chef_foodcritic_failure": null,
  "chef_up_for_adoption": null,
  "rating": null,
  "followers_count": 3,
  "downloads_count": 2530120,
  "downloads_count_revision": 1264947,
  "repository_url": "https://github.com/echaeu/echa-oracle",
  "issues_url": "https://github.com/echaeu/echa-oracle",
  "chef_source_url": "https://github.com/echaeu/echa-oracle",
  "gatherbase_origin": "chef-supermarket",
  "readme_name": "README.md",
  "readme": "Description\n===========\n\nInstalls and configures the Oracle RDBMS, patches it to the latest\nversion, and creates databases.\n\nTested with an Open Source Chef Server/Chef Client combo only.\n\nOracle version 11.2.0.3 was used to develop this cookbook, but the\ncode should work for other versions as well, with some\nmodifications.\n\nThe latest patch from My Oracle Support (MOS) as of this writing is\nPatch 16056266 - 11.2.0.3.6 Patch Set Update.\n\nAt the time this cookbook was being developed the latest patch was\nPatch 14727310 - 11.2.0.3.5, which is the one it uses.\n\nFor guidelines on how to adapt the cookbook for other PSU versions,\nsee `latest_dbpatch`, under `Recipes`, below.\n\n\nQuickstart\n==========\n\n* Have either an open Source Chef Server or a Hosted Chef account at\n  the ready.\n* Spin up a CentOS VM using your choice of hypervisor and/or Vagrant,\n  and the `CentOS-6.4-x86_64-minimal.iso`, which you can get here:\n\n  [`CentOS-6.4-x86_64-minimal.iso`](https://www.centos.org/)\n\n* Your NIC is not up by default, make sure to edit the\n  `/etc/sysconfig/ifcfg-eth0` file and run `service network start`.\n* Make sure your FQDN is properly configured (test this with\n  `hostname -f`), else `runInstaller` will fail.\n* You don't want to transfer Oracle's binaries in the clear across\n  the Internet. Set up a Web server to serve them over HTTPS unless\n  you're on a secure local network.\n* Create a role to override the default attribute values for the URLs\n  of Oracle's install files & patches with your own; e.g.:\n\n        name \"ora_quickstart\"\n        description \"Role applied to Oracle quickstart test machines.\"\n        run_list 'recipe[echa-oracle]', 'recipe[echa-oracle::logrotate_alert_log]', 'recipe[echa-oracle::logrotate_listener]', 'recipe[echa-oracle::createdb]'\n        override_attributes :oracle => {:rdbms => {:latest_patch => {:url => 'https://secure.server.localdomain/path/to/p14727310_112030_Linux_x86_64.zip'}, :opatch_update_url => 'https://secure.server.localdomain/path/to/p6880880_112000_Linux_x86_64.zip', :install_files => ['https://secure.server.localdomain/path/to/p10404530_112030_Linux-x86-64_1of7.zip', 'https://secure.server.localdomain/path/to/p10404530_112030_Linux-x86-64_2of7.zip']}}\n\n\n* You need to set up an encrypted data bag item to secure the oracle\n  user's password. See Opscode's docs site for details on encrypted\n  data bags:\n  [encrypted data bag doc](http://docs.opscode.com/essentials_data_bags_encrypt.html)\n  Your encrypted item requires a key named `pw`, whose value is the\n  password of the oracle user- you can set that to whatever you want.\n  You must set the value of `node[:oracle][:user][:edb]` to the name\n  of your data bag, and that of `node[:oracle][:user][:edb_item]` to\n  the name of the encrypted item; the defaults are `oracle` and\n  `foo`, respectively.\n\n* If you're using the open source Chef Server, add this line to\n  /etc/chef-server/chef-server.rb:\n\n  `erchef['s3_url_ttl'] = 9999`\n\n  then run `chef-server-ctl reconfigure` to reconfigure Chef Server.\n  This config edit avoids running into CHEF-3045, which we are liable\n  to do because of the time it takes to install Oracle's binaries and\n  spin up a database.\n\n* Bootstrap the node, telling Chef to create the FOO database on it:\n\n        knife bootstrap HOSTNAME -r 'role[ora_quickstart]' -j '{\"oracle\" : {\"rdbms\": {\"dbs\": {\"FOO\" : false}}}}'\n\n* Go grab a cup of tea, as this is apt to take a fair amount of time\nto complete :-)\n\nRequirements\n============\n\n## Oracle\n\nSee here:\n\n[Oracle's requirements](http://docs.oracle.com/cd/E11882_01/install.112/e24321/pre_install.htm#i1011296)\n\n## Chef\n\nThis cookbook was successfully tested using Chef-Client 11, in combo\nwith the open source Chef Server 11, as well as with Hosted Chef.\n\nIf you use the open source Chef Server, because installing a\ndatabase takes a long while, and owing to\n[CHEF-3045](http://tickets.opscode.com/browse/CHEF-3045), you'll want\nto increase the value of `erchef['s3_url_ttl']` in\n`/etc/chef-server/chef-server.rb`; which value to choose depends on the\nnumber of databases you create, and how fast your nodes are. In most\ncases, this should give you room to spare to install a couple\ndatabases:\n\n`erchef['s3_url_ttl'] = 9999`\n\nthen run `chef-server-ctl reconfigure` to reconfigure Chef Server.\n\n## Platforms\n\n* `CentOS 6.4 (x86_64)`\n* `RHEL 6.4 (x86_64)`\n* `Scientific Linux 6.4 (x86_64)`\n\necha-oracle was tested on the distros/versions given above; YMMV on\nolder versions of their 6.x branches.\nThe development target was `Centos x86_64 minimal install`.\nDISCLAIMER: note that, out of those three platforms, Oracle Database\n11g R2 is only certified on RHEL 6 :-) For more detail, check the\ncertification matrix on My Oracle Support:\n[certification matrix](https://support.oracle.com)\n\n## Packages\n\n* Access to My Oracle Support to download the 11.2.0.3 install media\n  and the patch files.\n\n  You will not be able to download the 11.2.0.3 install files from\n  Oracle Technology Network (OTN), since the version available there\n  is 11.2.0.1. From:\n  [Oracle DB Downloads page](http://www.oracle.com/technetwork/database/enterprise-edition/downloads/index.html)\n\n  > \"11/10/11: Patch Set 11.2.0.3 for Linux, Solaris, Windows, AIX\n  and HP-UX Itanium is now available on support.oracle.com. Note: it\n  is a full installation (you do not need to download 11.2.0.1\n  first). See the README for more info (login to My Oracle Support\n  required).\"\n\n  For this version of the cookbook, you'll need the following\n  packages:\n\n  Patch 14727310 (11.2.0.3.5): `p14727310_112030_Linux_x86_64.zip`  \n  OPatch 6880880 (11.2.0.3.3): `p6880880_112000_Linux_x86_64.zip`  \n  Oracle 11.2.0.3 media: `p10404530_112030_Linux-x86-64_1of7.zip`  \n  Oracle 11.2.0.3 media: `p10404530_112030_Linux-x86-64_2of7.zip`  \n\n  Note: You don't need all seven 11.2.0.3 media files in order to\n  just install the RDBMS' binaries.\n\n## Miscellaneous\n\n* Ensure that your FQDN is properly configured (check the output of\n  `hostname -f`), else runInstaller will fail.\n* At least a basic knowledge of Oracle administration will come in\n  handy, in particular if you want to modify attributes' values\n  and/or modify the cookbook's code or resources.\n* If you want to increase the size of `/dev/shm`, edit `/etc/fstab`\n  accordingly, and make sure to add this entry to `/etc/rc.local` or\n  `/etc/rc.d/rc.sysinit` to have your changes persist across reboots:\n\n  `/bin/mount -o remount /dev/shm`\n\n  This works around a bug in RHEL and derivatives:\n  [Red Hat Bugzilla Bug 669700](https://bugzilla.redhat.com/show_bug.cgi?id=669700)\n\n\nAttributes\n==========\n\necha-oracle defines a single top-level namespace: `:oracle`. Values\nthat pertain to the whole Oracle setup (not only the RDBMS) are\ndefined there directly:\n* `node[:oracle][:ora_base]` - sets the Oracle base's absolute\n  pathname, defaults to `/opt/oracle`.\n* `node[:oracle][:ora_inventory]` - sets oraInventory's absolute\n  pathname, defaults to `/opt/oraInventory`.\n\n\n`:oracle` has two children: `:user`, and `:rdbms`.\n\nAttributes under `:user` are specific to the oracle user, as you may\nhave guessed:\n* `node[:oracle][:user][:uid]`\n* `node[:oracle][:user][:gid]`\n* `node[:oracle][:user][:shell]`- note that this is set to `/bin/ksh`\n  by default.\n* `node[:oracle][:user][:sup_grps]` - sets the oracle user's\n  supplementary groups, a Hash whose keys are group names, and\n  whose values are gids. The default value is  `{'dba' => 202}`.\n* `node[:oracle][:user][:pw_set]` - a flag that indicates whether the\n  `oracle_user_config` recipe has set the password of the oracle\n  user (and can thus skip doing it again); defaults to `false`.\n* `node[:oracle][:user][:edb]` - sets the name of the data bag from\n  which we'll fetch the encrypted item storing the oracle user's\n  password. Defaults to `oracle`.\n* `node[:oracle][:user][:edb_item]` - sets the name of the encrypted\n  item in which the oracle user's password is stored. Defaults to\n  `foo`.\n\nAttributes under `:rdbms` relate to the Oracle RDBMS proper,\nrather unsurprisingly:\n* `node[:oracle][:rdbms][:ora_home]` - sets the oracle home's absolute\n  pathname; defaults to  `#{node[:oracle][:ora_base]}/11R23`.\n* `node[:oracle][:rdbms][:is_installed]` - flag to indicate whether\n  the dbbin recipe has installed the RDBMS, and can thus be skipped.\n* `node[:oracle][:rdbms][:install_info]` - a Hash storing information\n  about the RDBMS installed on the node (version, patch number, and\n  timestamp of last patching); defaults to the empty Hash. See the\n  `get_version recipe` for greater detail.\n* `node[:oracle][:rdbms][:install_dir]` - sets the oracle installation\n  directory's absolute pathname; defaults to `#{node[:oracle][:ora_base]}/install_dir`\n* `node[:oracle][:rdbms][:response_file_url]` - sets the URL of the\n  response file you want Chef to use instead of having it generate a \n  basic ocm.rsp itself.\n* `node[:oracle][:rdbms][:deps]` - an Array storing the package names\n  of the Oracle RDBMS' dependencies.\n* `node[:oracle][:rdbms][:env]` - a Hash of variable names/values that\n  makes up the RDBMS-specific environment for the oracle user.\n* `node[:oracle][:rdbms][:install_files]` - an Array of URLs that\n  specify the locations of the Oracle RDBMS' installation files:\n  `p10404530_112030_Linux-x86-64_1of7.zip` and `p10404530_112030_Linux-x86-64_2of7.zip`.\n* `node[:oracle][:rdbms][:sys_pw]` - sets the password for the `SYS`\n  default open database user. Has a default placeholder value.\n* `node[:oracle][:rdbms][:system_pw]` - sets the password for the `SYSTEM`\n  default open database user. Has a default placeholder value.\n* `node[:oracle][:rdbms][:dbsnmp_pw]` - sets the password for the `DBSNMP`\n  default open database user. Has a default placeholder value.\n* `node[:oracle][:rdbms][:opatch_update_url]` - sets the URL of the\n  OPatch update (`p6880880_112000_Linux_x86_64.zip)`.\n* `node[:oracle][:rdbms][:latest_patch][:url]` - URL of the latest\n  Oracle RDBMS patch (`p14727310_112030_Linux_x86_64.zip`).\n* `node[:oracle][:rdbms][:latest_patch][:dirname]` - sets the name of\n  the latest patch's expanded directory. Will typically match the\n  part of the latest patch's filename following the initial 'p', up\n  until (and exclusive of) the first `_` (`14727310`, in our\n  case), but this is not guaranteed.\n* `node[:oracle][:rdbms][:latest_patch][:is_installed]` - flag to\n  indicate whether `latest_dbpatch` recipe has patched the RDBMS, and\n  can thus be skipped.\n* `node[:oracle][:rdbms][:dbs]` - a Hash whose keys are database names\n  and whose values are Booleans. A value of true indicates that the\n  database has already been created, and should thus be skipped by\n  the createdb recipe. Defaults to the empty Hash.\n* `node[:oracle][:rdbms][:dbs_root]` - sets the pathname of the root\n  directory for the databases.\n\n\nRecipes\n=======\n\nBy order of appearance in a typical workflow:\n\n## default\n\nIncludes 5 recipes, which are, in order:\n\n* `echa-oracle::oracle_user_config`\n* `echa-oracle::deps_install`\n* `echa-oracle::kernel_params`\n* `echa-oracle::dbbin` unless `node[:oracle][:rdbms][:is_installed]`'s value is `true`.\n* `echa-oracle::latest_dbpatch` unless `node[:oracle][:rdbms][:latest_patch][:is_installed]`'s value is `true`.\n\nIOW, we set up the oracle user, install Oracle's dependencies, tweak\nthe kernel's parameters, then install the Oracle binaries (unless\nwe've done so already, and patch them to the latest patch version\n(unless we've done so already).\n\n## `oracle_user_config`\n\nCreate and configure the oracle user. Its password is only set if\n`node[:oracle][:user][:pw_set]`'s value isn't true .\n`node[:oracle][:user][:pw_set]`'s value is `false` by default; it's\nflipped to `true` after we set the password, meaning that, if you want\nto change the password after the first Chef run, you'll have to flip\nit back.\n\nThe recipe expects the oracle user password to be stored in an\nencrypted data bag item; the bag's name is controlled by the\n`node[:oracle][:user][:edb]` attribute, whose default value is\n`oracle`. The item's name is controlled by the `node[:oracle][:user][:edb_item]`\nattribute, whose default value is `foo`.\n\nThe recipe requires the encrypted item to include a key named `pw`,\nwhose value you must set to the oracle user's password.\n\nFor more detail on encrypted data bags, see:\n[Opscode's doc on encrypted data bags](http://docs.opscode.com/essentials_data_bags_encrypt.html)\n\n\n## `deps_install`\n\nInstalls the Oracle RDBMS' dependencies, which are specified as an\nArray of package names that's the value of `node[:oracle][:rdbms][:deps]`.\n\n## `kernel_params`\n\nConfigures kernel parameters for Oracle. We deploy a config file to\n`/etc/sysctl.d/ora_params` and reload `sysctl` settings.\n\n## `dbbin`\n\nInstalls Oracle RDBMS binaries. The install files are specified as\nan Array of URLs that's the value of the `node[:oracle][:rdbms][:install_files]`\nattribute.\n\n## `latest_dbpatch`\n\nInstalls latest patch for Oracle RDBMS. The patch file is specified\nas a URL that's the value of `node[:oracle][:rdbms][:latest_patch][:url]`.\n\nApplying Patch 16056266 with `latest_patch.rb` has not been tested,\nbut it should work, just by setting `node[:oracle][:rdbms][:latest_patch][:url]`\nto the proper URL, pointing at that patch on your HTTPS server.\n\nAlso remember to update OPatch 6880880 to the latest version.\n\nPrevious PSU patches should work without many changes. 11.2.0.3.3\nworked fine in our environment.\n\n## `get_version`\n\nIncluded by `latest_patch`. Populates `node[:oracle][:rdbms][:install_info]`'s\nHash with key/value pairs that track the patch number, the patch's\ntimestamp, and the version string, as extracted from the output of:\n\n`opatch lsinventory -bugs_fixed`\n\n## `createdb`\n\nCreates databases. Iterates over the keys of the `node[:oracle][:rdbms][:dbs]`'s\nHash, creating a database for each key whose value isn't truthy.\nYou're meant to specify this Hash yourself, for example in a role,\nor as part of the bootstrap command line, e.g.:\n\n`[snip] -j '{\"oracle\" : {\"rdbms\": {\"dbs\": {\"FOO\" : false}}}}'`\n\nThe value associated with a key is set to `true` after its\ncorresponding database has been created.\n\n## `logrotate_alert_log`\n\nlogrotate config for the Oracle alert log.\n\n## `logrotate_listener`\n\nlogrotate config for the Oracle listener's log.\n\n\nUsage Notes\n===========\n\n* You can customise most installation paths and related settings;\n  see the Attributes section, above, for details.\n* Database is installed on the root (`/`) filesystem. DBAs are\n  encouraged to improve the disk/fs layout as they see fit, and/or\n  to fit local practice.\n* The database template (created by DBCA) is not an Oracle best\n  practise, feel free to replace it with one of your own creation.\n* The database filesystem root is parameterised, using `node[:oracle][:rdbms][:dbs_root]`.\n  This attribute is leveraged in the database template we ship. If\n  you want to do the same with your own database template, you'll\n  have to turn it into a Chef template as well (and use\n  search-and-replace).\n* Replace the default ocm.rsp with your own if you want to add your\n  email address for updates. Use the `$ORACLE_HOME/OPatch/ocm/bin/emocmrsp`\n  command to do that (pass it the `-help` switch to check its usage).\n  Then put the new reponse file on your HTTPS server and set\n   `node[:oracle][:rdbms][:response_file_url]` to the file's URL.\n* `dbbin` takes a long time to complete; hence the potential issue\n  with CHEF-3045 for open source Chef Server users.\n* On a similar note, `createdb` supports the creation of several DBs\n  on the same host, but this is apt to take a small eternity to\n  complete.\n\n\nRoadmap\n=======\n\n* Add OEM 11g agent installation\n* Add Oracle ASM instance creation\n* More robust way of detecting whether the rdbms binaries and latest\n  patch are installed on the node.\n\nAdditional Info\n===============\n\nAri has a blog where he gets into more detail about our testing\nof echa-oracle cookbook on two cloud providers (using Hosted Chef), and Chefy\nand Oracly things generally:\n\n<http://oraarir.blogspot.fi/>\n\nContributing\n===========\n\n1. Fork the repository on Github: [echa-oracle's GitHub repo](https://github.com/echaeu/echa-oracle)\n2. Create a named feature branch (like `add_component_x`)\n3. Write your changes\n4. Write tests for your changes (if applicable)\n5. Run the tests, ensuring they all pass\n6. Submit a Pull Request using Github\n\nLicense and Authors\n===================\n\nEmail:: <chef-oss@echa.europa.eu>\nAuthor:: Ari Riikonen\nAuthor:: Dominique Poulain\n\nCopyright:: 2013, ECHA\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n<http://www.apache.org/licenses/LICENSE-2.0>\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n"
}